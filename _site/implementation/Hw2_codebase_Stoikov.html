<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>hw2_codebase_stoikov â€“ mag7Alpha</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">mag7Alpha</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<div id="initial_id" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2025-04-20T19:12:45.422578Z&quot;,&quot;start_time&quot;:&quot;2025-04-20T19:12:44.252796Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> eastern</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytz</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shinybroker <span class="im">as</span> sb</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> timedelta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="633e9c69a022569" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2025-04-20T19:13:30.256295Z&quot;,&quot;start_time&quot;:&quot;2025-04-20T19:13:30.251503Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>asset_symbol <span class="op">=</span> <span class="st">"MSFT"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3d5b1d851832e8ef" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2025-04-20T19:13:32.437514Z&quot;,&quot;start_time&quot;:&quot;2025-04-20T19:13:32.200402Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">############ Risk Tolerance Calculation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>asset_data_vix <span class="op">=</span> sb.fetch_historical_data(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    contract<span class="op">=</span>sb.Contract({</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'symbol'</span>: <span class="st">'VIX'</span>,  <span class="co"># or 'VX' for VIX futures</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'secType'</span>: <span class="st">'IND'</span>,  <span class="co"># Futures contract type</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'exchange'</span>: <span class="st">'CBOE'</span>,  <span class="co"># CBOE Futures Exchange for VIX futures</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'currency'</span>: <span class="st">'USD'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    barSizeSetting<span class="op">=</span><span class="st">'1 day'</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    durationStr<span class="op">=</span><span class="st">'1 Y'</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(asset_data_vix)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the DataFrame from the result</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> asset_data_vix[<span class="st">'hst_dta'</span>]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure timestamp is in datetime format</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'timestamp'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'timestamp'</span>])</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new DataFrame with just the date and scaled high value</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>risktol_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Timestamp'</span>: df[<span class="st">'timestamp'</span>].dt.date,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'risk_tolerance'</span>: df[<span class="st">'high'</span>] <span class="op">*</span> <span class="fl">0.01</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Print header</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Timestamp   risk_tolerance"</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Print each row</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> risktol_df.iterrows():</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'Timestamp'</span>]<span class="sc">}</span><span class="ss">  </span><span class="sc">{</span>row[<span class="st">'risk_tolerance'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'startDateStr': '20240420 14:13:24 US/Central', 'endDateStr': '20250420 14:13:24 US/Central', 'hst_dta':       timestamp   open   high    low  close  volume  wap  barCount
0    2024-04-18  17.91  18.37  17.21  18.00       0  0.0      1989
1    2024-04-19  21.33  21.36  18.17  18.71       0  0.0      2231
2    2024-04-22  18.59  18.72  16.69  16.94       0  0.0      1607
3    2024-04-23  16.72  16.76  15.69  15.69       0  0.0      1290
4    2024-04-24  15.76  16.38  15.58  15.97       0  0.0      1451
..          ...    ...    ...    ...    ...     ...  ...       ...
246  2025-04-11  40.80  46.12  36.85  37.56       0  0.0      2880
247  2025-04-14  34.76  35.17  29.75  30.89       0  0.0      2539
248  2025-04-15  30.01  31.45  28.29  30.12       0  0.0      2561
249  2025-04-16  33.24  34.96  29.48  32.64       0  0.0      2520
250  2025-04-17  30.79  32.55  29.57  29.65       0  0.0      2430

[251 rows x 8 columns]}
Timestamp   risk_tolerance
2024-04-18  0.1837
2024-04-19  0.2136
2024-04-22  0.1872
2024-04-23  0.1676
2024-04-24  0.1638
2024-04-25  0.1755
2024-04-26  0.1606
2024-04-29  0.1542
2024-04-30  0.1590
2024-05-01  0.1622
2024-05-02  0.1609
2024-05-03  0.1458
2024-05-06  0.1402
2024-05-07  0.1364
2024-05-08  0.1351
2024-05-09  0.1329
2024-05-10  0.1296
2024-05-13  0.1366
2024-05-14  0.1403
2024-05-15  0.1394
2024-05-16  0.1267
2024-05-17  0.1248
2024-05-20  0.1259
2024-05-21  0.1256
2024-05-22  0.1281
2024-05-23  0.1337
2024-05-24  0.1289
2024-05-28  0.1344
2024-05-29  0.1432
2024-05-30  0.1488
2024-05-31  0.1487
2024-06-03  0.1431
2024-06-04  0.1408
2024-06-05  0.1325
2024-06-06  0.1298
2024-06-07  0.1308
2024-06-10  0.1328
2024-06-11  0.1347
2024-06-12  0.1315
2024-06-13  0.1268
2024-06-14  0.1345
2024-06-17  0.1329
2024-06-18  0.1274
2024-06-20  0.1355
2024-06-21  0.1378
2024-06-24  0.1388
2024-06-25  0.1352
2024-06-26  0.1324
2024-06-27  0.1277
2024-06-28  0.1276
2024-07-01  0.1326
2024-07-02  0.1288
2024-07-03  0.1223
2024-07-05  0.1261
2024-07-08  0.1291
2024-07-09  0.1261
2024-07-10  0.1292
2024-07-11  0.1333
2024-07-12  0.1289
2024-07-15  0.1326
2024-07-16  0.1347
2024-07-17  0.1488
2024-07-18  0.1643
2024-07-19  0.1719
2024-07-22  0.1689
2024-07-23  0.1535
2024-07-24  0.1846
2024-07-25  0.1936
2024-07-26  0.1805
2024-07-29  0.1721
2024-07-30  0.1832
2024-07-31  0.1677
2024-08-01  0.1948
2024-08-02  0.2966
2024-08-05  0.6573
2024-08-06  0.3477
2024-08-07  0.2976
2024-08-08  0.2947
2024-08-09  0.2452
2024-08-12  0.2119
2024-08-13  0.2079
2024-08-14  0.1849
2024-08-15  0.1668
2024-08-16  0.1576
2024-08-19  0.1607
2024-08-20  0.1593
2024-08-21  0.1717
2024-08-22  0.1806
2024-08-23  0.1721
2024-08-26  0.1667
2024-08-27  0.1681
2024-08-28  0.1789
2024-08-29  0.1657
2024-08-30  0.1604
2024-09-03  0.2199
2024-09-04  0.2331
2024-09-05  0.2153
2024-09-06  0.2376
2024-09-09  0.2141
2024-09-10  0.2074
2024-09-11  0.2141
2024-09-12  0.1859
2024-09-13  0.1718
2024-09-16  0.1769
2024-09-17  0.1808
2024-09-18  0.1939
2024-09-19  0.1727
2024-09-20  0.1668
2024-09-23  0.1695
2024-09-24  0.1667
2024-09-25  0.1582
2024-09-26  0.1583
2024-09-27  0.1697
2024-09-30  0.1779
2024-10-01  0.2073
2024-10-02  0.2036
2024-10-03  0.2075
2024-10-04  0.2048
2024-10-07  0.2303
2024-10-08  0.2314
2024-10-09  0.2201
2024-10-10  0.2139
2024-10-11  0.2116
2024-10-14  0.2086
2024-10-15  0.2089
2024-10-16  0.2101
2024-10-17  0.1965
2024-10-18  0.1932
2024-10-21  0.1934
2024-10-22  0.1944
2024-10-23  0.2047
2024-10-24  0.2024
2024-10-25  0.2051
2024-10-28  0.1988
2024-10-29  0.2053
2024-10-30  0.2044
2024-10-31  0.2342
2024-11-01  0.2309
2024-11-04  0.2307
2024-11-05  0.2206
2024-11-06  0.1682
2024-11-07  0.1586
2024-11-08  0.1533
2024-11-11  0.1556
2024-11-12  0.1537
2024-11-13  0.1526
2024-11-14  0.1432
2024-11-15  0.1755
2024-11-18  0.1700
2024-11-19  0.1793
2024-11-20  0.1879
2024-11-21  0.1799
2024-11-22  0.1756
2024-11-25  0.1572
2024-11-26  0.1503
2024-11-27  0.1513
2024-11-29  0.1415
2024-12-02  0.1410
2024-12-03  0.1377
2024-12-04  0.1361
2024-12-05  0.1370
2024-12-06  0.1374
2024-12-09  0.1423
2024-12-10  0.1454
2024-12-11  0.1443
2024-12-12  0.1395
2024-12-13  0.1425
2024-12-16  0.1469
2024-12-17  0.1594
2024-12-18  0.2832
2024-12-19  0.2412
2024-12-20  0.2651
2024-12-23  0.2002
2024-12-24  0.1704
2024-12-26  0.1593
2024-12-27  0.1845
2024-12-30  0.1922
2024-12-31  0.1781
2025-01-02  0.1950
2025-01-03  0.1794
2025-01-06  0.1687
2025-01-07  0.1890
2025-01-08  0.1950
2025-01-10  0.2031
2025-01-13  0.2204
2025-01-14  0.1966
2025-01-15  0.1914
2025-01-16  0.1660
2025-01-17  0.1623
2025-01-21  0.1629
2025-01-22  0.1529
2025-01-23  0.1539
2025-01-24  0.1516
2025-01-27  0.2251
2025-01-28  0.1839
2025-01-29  0.1808
2025-01-30  0.1642
2025-01-31  0.1709
2025-02-03  0.2042
2025-02-04  0.1911
2025-02-05  0.1775
2025-02-06  0.1615
2025-02-07  0.1666
2025-02-10  0.1661
2025-02-11  0.1642
2025-02-12  0.1718
2025-02-13  0.1633
2025-02-14  0.1542
2025-02-18  0.1603
2025-02-19  0.1590
2025-02-20  0.1663
2025-02-21  0.1903
2025-02-24  0.2024
2025-02-25  0.2148
2025-02-26  0.2006
2025-02-27  0.2147
2025-02-28  0.2240
2025-03-03  0.2431
2025-03-04  0.2635
2025-03-05  0.2484
2025-03-06  0.2592
2025-03-07  0.2656
2025-03-10  0.2956
2025-03-11  0.2957
2025-03-12  0.2691
2025-03-13  0.2613
2025-03-14  0.2436
2025-03-17  0.2295
2025-03-18  0.2257
2025-03-19  0.2210
2025-03-20  0.2117
2025-03-21  0.2110
2025-03-24  0.1914
2025-03-25  0.1777
2025-03-26  0.1907
2025-03-27  0.1928
2025-03-28  0.2218
2025-03-31  0.2480
2025-04-01  0.2352
2025-04-02  0.2366
2025-04-03  0.3002
2025-04-04  0.4561
2025-04-07  0.6013
2025-04-08  0.5752
2025-04-09  0.5796
2025-04-10  0.5487
2025-04-11  0.4612
2025-04-14  0.3517
2025-04-15  0.3145
2025-04-16  0.3496
2025-04-17  0.3255</code></pre>
</div>
</div>
<div id="62bc9a6558c7651d" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2025-04-20T19:13:35.474937Z&quot;,&quot;start_time&quot;:&quot;2025-04-20T19:13:34.731566Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">############ Asset related</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>asset_ask_data <span class="op">=</span> sb.fetch_historical_data(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    contract<span class="op">=</span>sb.Contract({</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'symbol'</span>: asset_symbol,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'secType'</span>: <span class="st">'STK'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'exchange'</span>: <span class="st">'SMART'</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'currency'</span>: <span class="st">'USD'</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    barSizeSetting<span class="op">=</span><span class="st">'30 secs'</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    durationStr<span class="op">=</span><span class="st">'1 D'</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    whatToShow <span class="op">=</span> <span class="st">'ASK'</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>asset_bid_data <span class="op">=</span> sb.fetch_historical_data(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    contract<span class="op">=</span>sb.Contract({</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'symbol'</span>: asset_symbol,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'secType'</span>: <span class="st">'STK'</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'exchange'</span>: <span class="st">'SMART'</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'currency'</span>: <span class="st">'USD'</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    barSizeSetting<span class="op">=</span><span class="st">'30 secs'</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    durationStr<span class="op">=</span><span class="st">'1 D'</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    whatToShow <span class="op">=</span> <span class="st">'BID'</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>ask_df <span class="op">=</span> asset_ask_data[<span class="st">'hst_dta'</span>][[<span class="st">'timestamp'</span>, <span class="st">'low'</span>]].rename(columns<span class="op">=</span>{<span class="st">'low'</span>: <span class="st">'ask_low'</span>})</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>bid_df <span class="op">=</span> asset_bid_data[<span class="st">'hst_dta'</span>][[<span class="st">'timestamp'</span>, <span class="st">'high'</span>]].rename(columns<span class="op">=</span>{<span class="st">'high'</span>: <span class="st">'bid_high'</span>})</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> ask_df.merge(bid_df, on<span class="op">=</span><span class="st">'timestamp'</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">'mid_price'</span>] <span class="op">=</span> (merged_df[<span class="st">'ask_low'</span>] <span class="op">+</span> merged_df[<span class="st">'bid_high'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">#print(merged_df)</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co">############ Set initial parameters</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Rolling Std of Mid-Price Returns</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">'log_return'</span>] <span class="op">=</span> np.log(merged_df[<span class="st">'mid_price'</span>] <span class="op">/</span> merged_df[<span class="st">'mid_price'</span>].shift(<span class="dv">1</span>))</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> <span class="dv">30</span>  <span class="co"># Example: 60 periods</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">'rolling_volatility'</span>] <span class="op">=</span> merged_df[<span class="st">'log_return'</span>].rolling(window<span class="op">=</span>window).std()</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>merged_df.dropna(subset<span class="op">=</span>[<span class="st">'rolling_volatility'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(merged_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              timestamp  ask_low  bid_high  mid_price    log_return  \
30  2025-04-17 09:45:00   371.28    371.62    371.450 -2.288068e-04   
31  2025-04-17 09:45:30   371.43    371.57    371.500  1.345986e-04   
32  2025-04-17 09:46:00   371.14    371.57    371.355 -3.903857e-04   
33  2025-04-17 09:46:30   370.90    371.03    370.965 -1.050760e-03   
34  2025-04-17 09:47:00   371.00    371.15    371.075  2.964800e-04   
35  2025-04-17 09:47:30   371.02    371.18    371.100  6.736956e-05   
36  2025-04-17 09:48:00   371.14    371.50    371.320  5.926565e-04   
37  2025-04-17 09:48:30   371.23    371.41    371.320  2.220446e-16   
38  2025-04-17 09:49:00   371.25    371.50    371.375  1.481093e-04   
39  2025-04-17 09:49:30   371.28    371.91    371.595  5.922177e-04   
40  2025-04-17 09:50:00   371.95    372.06    372.005  1.102744e-03   
41  2025-04-17 09:50:30   372.08    372.73    372.405  1.074677e-03   
42  2025-04-17 09:51:00   372.62    372.81    372.715  8.320808e-04   
43  2025-04-17 09:51:30   372.40    372.65    372.525 -5.099029e-04   
44  2025-04-17 09:52:00   372.50    372.98    372.740  5.769760e-04   
45  2025-04-17 09:52:30   372.88    372.94    372.910  4.559780e-04   
46  2025-04-17 09:53:00   372.81    372.99    372.900 -2.681648e-05   
47  2025-04-17 09:53:30   372.72    372.85    372.785 -3.084412e-04   
48  2025-04-17 09:54:00   372.76    373.18    372.970  4.961415e-04   
49  2025-04-17 09:54:30   372.83    373.05    372.940 -8.043866e-05   
50  2025-04-17 09:55:00   372.53    372.77    372.650 -7.779075e-04   
51  2025-04-17 09:55:30   372.65    372.80    372.725  2.012410e-04   
52  2025-04-17 09:56:00   372.48    372.78    372.630 -2.549121e-04   
53  2025-04-17 09:56:30   372.30    372.38    372.340 -7.785549e-04   
54  2025-04-17 09:57:00   372.17    372.29    372.230 -2.954726e-04   
55  2025-04-17 09:57:30   371.96    372.13    372.045 -4.971281e-04   
56  2025-04-17 09:58:00   371.84    372.11    371.975 -1.881670e-04   
57  2025-04-17 09:58:30   372.06    372.05    372.055  2.150451e-04   
58  2025-04-17 09:59:00   371.96    372.27    372.115  1.612535e-04   
59  2025-04-17 09:59:30   372.35    372.39    372.370  6.850373e-04   
60  2025-04-17 10:00:00   371.77    372.41    372.090 -7.522231e-04   
61  2025-04-17 10:00:30   371.64    371.98    371.810 -7.527894e-04   
62  2025-04-17 10:01:00   371.98    372.33    372.155  9.274631e-04   
63  2025-04-17 10:01:30   372.08    372.45    372.265  2.955321e-04   
64  2025-04-17 10:02:00   371.72    372.02    371.870 -1.061635e-03   
65  2025-04-17 10:02:30   371.39    371.59    371.490 -1.022385e-03   
66  2025-04-17 10:03:00   371.16    371.53    371.345 -3.903963e-04   
67  2025-04-17 10:03:30   371.13    371.19    371.160 -4.983132e-04   
68  2025-04-17 10:04:00   370.72    371.07    370.895 -7.142328e-04   
69  2025-04-17 10:04:30   371.16    371.31    371.235  9.162816e-04   
70  2025-04-17 10:05:00   371.10    371.26    371.180 -1.481651e-04   
71  2025-04-17 10:05:30   371.13    371.40    371.265  2.289732e-04   
72  2025-04-17 10:06:00   371.25    371.42    371.335  1.885268e-04   
73  2025-04-17 10:06:30   370.39    371.20    370.795 -1.455271e-03   
74  2025-04-17 10:07:00   370.30    370.63    370.465 -8.903759e-04   
75  2025-04-17 10:07:30   369.71    370.25    369.980 -1.310023e-03   
76  2025-04-17 10:08:00   369.86    370.06    369.960 -5.405844e-05   
77  2025-04-17 10:08:30   369.92    370.15    370.035  2.027041e-04   
78  2025-04-17 10:09:00   369.91    370.08    369.995 -1.081037e-04   
79  2025-04-17 10:09:30   369.92    370.41    370.165  4.593601e-04   
80  2025-04-17 10:10:00   370.41    370.59    370.500  9.045926e-04   
81  2025-04-17 10:10:30   370.42    370.62    370.520  5.397965e-05   
82  2025-04-17 10:11:00   370.63    370.68    370.655  3.642864e-04   
83  2025-04-17 10:11:30   370.53    370.71    370.620 -9.443189e-05   
84  2025-04-17 10:12:00   370.77    371.12    370.945  8.765247e-04   
85  2025-04-17 10:12:30   371.20    371.33    371.265  8.622897e-04   
86  2025-04-17 10:13:00   370.76    371.20    370.980 -7.679405e-04   
87  2025-04-17 10:13:30   370.77    370.81    370.790 -5.122882e-04   
88  2025-04-17 10:14:00   370.76    370.83    370.795  1.348463e-05   
89  2025-04-17 10:14:30   370.60    370.68    370.640 -4.181081e-04   
90  2025-04-17 10:15:00   370.69    370.73    370.710  1.888447e-04   
91  2025-04-17 10:15:30   370.66    370.86    370.760  1.348672e-04   
92  2025-04-17 10:16:00   370.61    370.79    370.700 -1.618429e-04   
93  2025-04-17 10:16:30   370.61    370.65    370.630 -1.888498e-04   
94  2025-04-17 10:17:00   370.55    370.75    370.650  5.396072e-05   
95  2025-04-17 10:17:30   370.55    370.80    370.675  6.744680e-05   
96  2025-04-17 10:18:00   370.58    370.68    370.630 -1.214075e-04   
97  2025-04-17 10:18:30   370.60    370.69    370.645  4.047081e-05   
98  2025-04-17 10:19:00   370.40    370.59    370.495 -4.047818e-04   
99  2025-04-17 10:19:30   370.68    370.72    370.700  5.531608e-04   
100 2025-04-17 10:20:00   370.64    370.70    370.670 -8.093125e-05   
101 2025-04-17 10:20:30   370.71    370.80    370.755  2.292882e-04   
102 2025-04-17 10:21:00   370.63    370.79    370.710 -1.213813e-04   
103 2025-04-17 10:21:30   370.73    370.75    370.740  8.092252e-05   
104 2025-04-17 10:22:00   370.78    370.96    370.870  3.505886e-04   
105 2025-04-17 10:22:30   370.94    371.12    371.030  4.313250e-04   
106 2025-04-17 10:23:00   370.63    370.94    370.785 -6.605421e-04   
107 2025-04-17 10:23:30   370.73    370.88    370.805  5.393816e-05   
108 2025-04-17 10:24:00   370.06    370.60    370.330 -1.281818e-03   
109 2025-04-17 10:24:30   370.06    370.18    370.120 -5.672227e-04   
110 2025-04-17 10:25:00   370.17    370.39    370.280  4.321988e-04   
111 2025-04-17 10:25:30   370.29    370.30    370.295  4.050906e-05   
112 2025-04-17 10:26:00   370.07    370.23    370.150 -3.916564e-04   
113 2025-04-17 10:26:30   370.01    370.29    370.150  0.000000e+00   
114 2025-04-17 10:27:00   370.05    370.28    370.165  4.052329e-05   
115 2025-04-17 10:27:30   369.80    369.98    369.890 -7.431880e-04   
116 2025-04-17 10:28:00   370.06    370.06    370.060  4.594905e-04   
117 2025-04-17 10:28:30   370.01    370.21    370.110  1.351041e-04   
118 2025-04-17 10:29:00   370.09    370.20    370.145  9.456201e-05   
119 2025-04-17 10:29:30   370.18    370.29    370.235  2.431184e-04   
120 2025-04-17 10:30:00   370.24    370.54    370.390  4.185654e-04   
121 2025-04-17 10:30:30   369.84    370.54    370.190 -5.401172e-04   
122 2025-04-17 10:31:00   369.50    370.06    369.780 -1.108153e-03   
123 2025-04-17 10:31:30   369.62    370.00    369.810  8.112603e-05   
124 2025-04-17 10:32:00   369.59    370.04    369.815  1.352037e-05   
125 2025-04-17 10:32:30   369.58    369.68    369.630 -5.003753e-04   
126 2025-04-17 10:33:00   369.69    369.93    369.810  4.868549e-04   
127 2025-04-17 10:33:30   369.77    369.91    369.840  8.111945e-05   
128 2025-04-17 10:34:00   369.70    369.89    369.795 -1.216816e-04   
129 2025-04-17 10:34:30   369.57    369.64    369.605 -5.139302e-04   
130 2025-04-17 10:35:00   369.38    369.52    369.450 -4.194546e-04   
131 2025-04-17 10:35:30   369.38    369.46    369.420 -8.120508e-05   
132 2025-04-17 10:36:00   369.17    369.28    369.225 -5.279938e-04   
133 2025-04-17 10:36:30   369.13    369.30    369.215 -2.708412e-05   
134 2025-04-17 10:37:00   369.14    369.29    369.215  0.000000e+00   
135 2025-04-17 10:37:30   368.84    369.00    368.920 -7.993118e-04   
136 2025-04-17 10:38:00   368.79    369.08    368.935  4.065839e-05   
137 2025-04-17 10:38:30   368.82    368.98    368.900 -9.487216e-05   
138 2025-04-17 10:39:00   368.66    368.80    368.730 -4.609357e-04   
139 2025-04-17 10:39:30   368.84    368.87    368.855  3.389440e-04   
140 2025-04-17 10:40:00   368.70    368.81    368.755 -2.711460e-04   
141 2025-04-17 10:40:30   368.89    369.26    369.075  8.674085e-04   
142 2025-04-17 10:41:00   369.28    369.37    369.325  6.771398e-04   
143 2025-04-17 10:41:30   369.49    369.56    369.525  5.413819e-04   
144 2025-04-17 10:42:00   369.61    369.63    369.620  2.570538e-04   
145 2025-04-17 10:42:30   369.55    369.52    369.535 -2.299924e-04   
146 2025-04-17 10:43:00   369.67    369.85    369.760  6.086880e-04   
147 2025-04-17 10:43:30   369.71    369.83    369.770  2.704420e-05   
148 2025-04-17 10:44:00   369.66    369.66    369.660 -2.975265e-04   
149 2025-04-17 10:44:30   369.78    369.89    369.835  4.732960e-04   
150 2025-04-17 10:45:00   369.86    369.81    369.835  2.220446e-16   
151 2025-04-17 10:45:30   369.84    369.84    369.840  1.351945e-05   
152 2025-04-17 10:46:00   369.94    370.01    369.975  3.649561e-04   
153 2025-04-17 10:46:30   369.96    370.03    369.995  5.405625e-05   
154 2025-04-17 10:47:00   370.03    369.98    370.005  2.702703e-05   
155 2025-04-17 10:47:30   370.08    370.00    370.040  9.458884e-05   
156 2025-04-17 10:48:00   370.07    370.19    370.130  2.431874e-04   
157 2025-04-17 10:48:30   370.14    370.12    370.130  0.000000e+00   
158 2025-04-17 10:49:00   370.11    370.11    370.110 -5.403653e-05   
159 2025-04-17 10:49:30   370.07    370.20    370.135  6.754520e-05   
160 2025-04-17 10:50:00   370.29    370.42    370.355  5.942012e-04   
161 2025-04-17 10:50:30   370.07    370.34    370.205 -4.050988e-04   
162 2025-04-17 10:51:00   370.17    370.31    370.240  9.453774e-05   
163 2025-04-17 10:51:30   370.16    370.13    370.145 -2.566232e-04   
164 2025-04-17 10:52:00   370.15    370.14    370.145  0.000000e+00   
165 2025-04-17 10:52:30   369.86    370.04    369.950 -5.269594e-04   
166 2025-04-17 10:53:00   369.82    369.87    369.845 -2.838624e-04   
167 2025-04-17 10:53:30   369.88    369.93    369.905  1.622170e-04   
168 2025-04-17 10:54:00   370.00    370.02    370.010  2.838164e-04   
169 2025-04-17 10:54:30   370.10    370.02    370.060  1.351224e-04   
170 2025-04-17 10:55:00   370.01    370.10    370.055 -1.351141e-05   
171 2025-04-17 10:55:30   369.98    370.00    369.990 -1.756650e-04   
172 2025-04-17 10:56:00   370.01    370.02    370.015  6.756711e-05   
173 2025-04-17 10:56:30   370.04    370.17    370.105  2.432038e-04   
174 2025-04-17 10:57:00   369.83    369.90    369.865 -6.486750e-04   
175 2025-04-17 10:57:30   369.87    370.10    369.985  3.243901e-04   
176 2025-04-17 10:58:00   369.97    370.16    370.065  2.162016e-04   
177 2025-04-17 10:58:30   369.93    369.92    369.925 -3.783835e-04   
178 2025-04-17 10:59:00   369.83    369.90    369.865 -1.622082e-04   
179 2025-04-17 10:59:30   369.81    369.75    369.780 -2.298400e-04   
180 2025-04-17 11:00:00   369.77    369.89    369.830  1.352064e-04   
181 2025-04-17 11:00:30   369.71    369.88    369.795 -9.464256e-05   
182 2025-04-17 11:01:00   369.78    369.88    369.830  9.464256e-05   
183 2025-04-17 11:01:30   369.47    369.83    369.650 -4.868286e-04   
184 2025-04-17 11:02:00   369.46    369.65    369.555 -2.570329e-04   
185 2025-04-17 11:02:30   369.61    369.56    369.585  8.117542e-05   
186 2025-04-17 11:03:00   369.43    369.56    369.495 -2.435460e-04   
187 2025-04-17 11:03:30   369.42    369.43    369.425 -1.894657e-04   
188 2025-04-17 11:04:00   369.22    369.49    369.355 -1.895016e-04   
189 2025-04-17 11:04:30   369.49    369.48    369.485  3.519030e-04   
190 2025-04-17 11:05:00   369.56    369.69    369.625  3.788340e-04   
191 2025-04-17 11:05:30   369.70    369.88    369.790  4.462988e-04   
192 2025-04-17 11:06:00   370.00    370.69    370.345  1.499727e-03   
193 2025-04-17 11:06:30   370.77    371.39    371.080  1.982669e-03   
194 2025-04-17 11:07:00   371.31    371.65    371.480  1.077354e-03   
195 2025-04-17 11:07:30   371.26    371.62    371.440 -1.076832e-04   
196 2025-04-17 11:08:00   371.27    371.47    371.370 -1.884735e-04   
197 2025-04-17 11:08:30   371.46    371.54    371.500  3.499939e-04   
198 2025-04-17 11:09:00   371.25    371.40    371.325 -4.711742e-04   
199 2025-04-17 11:09:30   371.23    371.30    371.265 -1.615966e-04   
200 2025-04-17 11:10:00   371.27    371.30    371.285  5.386843e-05   
201 2025-04-17 11:10:30   371.48    371.59    371.535  6.731106e-04   
202 2025-04-17 11:11:00   371.71    371.71    371.710  4.709080e-04   
203 2025-04-17 11:11:30   371.58    371.72    371.650 -1.614292e-04   
204 2025-04-17 11:12:00   371.52    371.64    371.580 -1.883670e-04   
205 2025-04-17 11:12:30   371.67    371.70    371.685  2.825372e-04   
206 2025-04-17 11:13:00   371.57    371.62    371.595 -2.421698e-04   
207 2025-04-17 11:13:30   371.63    371.64    371.635  1.076383e-04   
208 2025-04-17 11:14:00   371.74    371.90    371.820  4.976764e-04   
209 2025-04-17 11:14:30   371.82    371.86    371.840  5.378802e-05   
210 2025-04-17 11:15:00   371.82    371.86    371.840  0.000000e+00   
211 2025-04-17 11:15:30   371.61    371.71    371.660 -4.841964e-04   
212 2025-04-17 11:16:00   371.55    371.55    371.550 -2.960132e-04   
213 2025-04-17 11:16:30   371.34    371.48    371.410 -3.768709e-04   
214 2025-04-17 11:17:00   371.43    371.55    371.490  2.153722e-04   
215 2025-04-17 11:17:30   371.67    371.96    371.815  8.744728e-04   
216 2025-04-17 11:18:00   371.96    372.24    372.100  7.662166e-04   
217 2025-04-17 11:18:30   372.30    372.37    372.335  6.313513e-04   
218 2025-04-17 11:19:00   372.06    372.22    372.140 -5.238591e-04   
219 2025-04-17 11:19:30   372.06    372.11    372.085 -1.478048e-04   
220 2025-04-17 11:20:00   371.98    372.08    372.030 -1.478266e-04   
221 2025-04-17 11:20:30   371.74    371.86    371.800 -6.184209e-04   
222 2025-04-17 11:21:00   371.69    371.67    371.680 -3.228063e-04   
223 2025-04-17 11:21:30   371.52    371.63    371.575 -2.825410e-04   
224 2025-04-17 11:22:00   371.45    371.56    371.505 -1.884050e-04   
225 2025-04-17 11:22:30   371.41    371.45    371.430 -2.019019e-04   
226 2025-04-17 11:23:00   371.42    371.53    371.475  1.211460e-04   
227 2025-04-17 11:23:30   371.34    371.57    371.455 -5.384087e-05   
228 2025-04-17 11:24:00   371.32    371.37    371.345 -2.961766e-04   
229 2025-04-17 11:24:30   371.43    371.47    371.450  2.827160e-04   
230 2025-04-17 11:25:00   371.33    371.38    371.355 -2.557872e-04   
231 2025-04-17 11:25:30   371.21    371.25    371.230 -3.366618e-04   
232 2025-04-17 11:26:00   371.18    371.24    371.210 -5.387641e-05   
233 2025-04-17 11:26:30   371.03    371.13    371.080 -3.502674e-04   
234 2025-04-17 11:27:00   370.92    370.97    370.945 -3.638691e-04   
235 2025-04-17 11:27:30   370.73    370.94    370.835 -2.965839e-04   
236 2025-04-17 11:28:00   370.65    370.72    370.685 -4.045744e-04   
237 2025-04-17 11:28:30   370.58    370.60    370.590 -2.563151e-04   
238 2025-04-17 11:29:00   370.43    370.48    370.455 -3.643503e-04   
239 2025-04-17 11:29:30   370.45    370.42    370.435 -5.398912e-05   
240 2025-04-17 11:30:00   370.42    370.62    370.520  2.294336e-04   
241 2025-04-17 11:30:30   370.69    370.72    370.705  4.991737e-04   
242 2025-04-17 11:31:00   370.78    371.02    370.900  5.258864e-04   
243 2025-04-17 11:31:30   371.03    371.08    371.055  4.178151e-04   
244 2025-04-17 11:32:00   371.13    371.16    371.145  2.425222e-04   
245 2025-04-17 11:32:30   371.13    371.27    371.200  1.481791e-04   
246 2025-04-17 11:33:00   371.30    371.36    371.330  3.501542e-04   
247 2025-04-17 11:33:30   371.28    371.31    371.295 -9.426023e-05   
248 2025-04-17 11:34:00   371.38    371.40    371.390  2.558285e-04   
249 2025-04-17 11:34:30   371.35    371.36    371.355 -9.424500e-05   
250 2025-04-17 11:35:00   370.99    371.25    371.120 -6.330180e-04   
251 2025-04-17 11:35:30   370.87    370.86    370.865 -6.873455e-04   
252 2025-04-17 11:36:00   370.81    370.82    370.815 -1.348290e-04   
253 2025-04-17 11:36:30   370.87    371.04    370.955  3.774755e-04   
254 2025-04-17 11:37:00   370.94    371.29    371.115  4.312262e-04   
255 2025-04-17 11:37:30   371.39    371.76    371.575  1.238740e-03   
256 2025-04-17 11:38:00   371.56    371.92    371.740  4.439571e-04   
257 2025-04-17 11:38:30   371.30    371.48    371.390 -9.419618e-04   
258 2025-04-17 11:39:00   371.34    371.45    371.395  1.346285e-05   
259 2025-04-17 11:39:30   371.46    371.46    371.460  1.750005e-04   
260 2025-04-17 11:40:00   371.53    371.56    371.545  2.288006e-04   
261 2025-04-17 11:40:30   371.57    371.54    371.555  2.691428e-05   
262 2025-04-17 11:41:00   371.39    371.68    371.535 -5.382928e-05   
263 2025-04-17 11:41:30   371.30    371.26    371.280 -6.865774e-04   
264 2025-04-17 11:42:00   371.12    371.16    371.140 -3.771450e-04   
265 2025-04-17 11:42:30   371.00    371.15    371.075 -1.751514e-04   
266 2025-04-17 11:43:00   370.97    370.91    370.940 -3.638740e-04   
267 2025-04-17 11:43:30   370.98    371.01    370.995  1.482610e-04   
268 2025-04-17 11:44:00   370.77    370.87    370.820 -4.718158e-04   
269 2025-04-17 11:44:30   370.77    370.68    370.725 -2.562218e-04   
270 2025-04-17 11:45:00   370.83    370.84    370.835  2.966719e-04   
271 2025-04-17 11:45:30   370.68    370.71    370.695 -3.775977e-04   
272 2025-04-17 11:46:00   370.58    370.57    370.575 -3.237687e-04   
273 2025-04-17 11:46:30   370.55    370.82    370.685  2.967920e-04   
274 2025-04-17 11:47:00   370.84    370.80    370.820  3.641243e-04   
275 2025-04-17 11:47:30   370.84    370.94    370.890  1.887530e-04   
276 2025-04-17 11:48:00   371.02    371.13    371.075  4.986758e-04   
277 2025-04-17 11:48:30   371.03    371.15    371.090  4.042228e-05   
278 2025-04-17 11:49:00   370.71    370.93    370.820 -7.278511e-04   
279 2025-04-17 11:49:30   370.51    370.59    370.550 -7.283813e-04   
280 2025-04-17 11:50:00   370.45    370.50    370.475 -2.024223e-04   
281 2025-04-17 11:50:30   370.51    370.53    370.520  1.214583e-04   
282 2025-04-17 11:51:00   370.42    370.86    370.640  3.238167e-04   
283 2025-04-17 11:51:30   370.97    371.04    371.005  9.842985e-04   
284 2025-04-17 11:52:00   371.21    371.32    371.265  7.005537e-04   
285 2025-04-17 11:52:30   371.06    371.35    371.205 -1.616227e-04   
286 2025-04-17 11:53:00   370.59    371.00    370.795 -1.105121e-03   
287 2025-04-17 11:53:30   370.71    370.68    370.695 -2.697272e-04   
288 2025-04-17 11:54:00   370.60    370.64    370.620 -2.023431e-04   
289 2025-04-17 11:54:30   370.67    370.71    370.690  1.888549e-04   
290 2025-04-17 11:55:00   370.66    370.75    370.705  4.046426e-05   
291 2025-04-17 11:55:30   370.88    371.05    370.965  7.011205e-04   
292 2025-04-17 11:56:00   371.10    371.16    371.130  4.446870e-04   
293 2025-04-17 11:56:30   371.07    371.08    371.075 -1.482070e-04   
294 2025-04-17 11:57:00   371.13    371.09    371.110  9.431611e-05   
295 2025-04-17 11:57:30   370.99    371.02    371.005 -2.829750e-04   
296 2025-04-17 11:58:00   370.90    370.90    370.900 -2.830551e-04   
297 2025-04-17 11:58:30   370.90    370.84    370.870 -8.088761e-05   
298 2025-04-17 11:59:00   370.84    370.82    370.830 -1.078603e-04   
299 2025-04-17 11:59:30   370.84    370.81    370.825 -1.348336e-05   
300 2025-04-17 12:00:00   370.83    371.32    371.075  6.739453e-04   
301 2025-04-17 12:00:30   371.11    371.07    371.090  4.042228e-05   
302 2025-04-17 12:01:00   371.00    371.05    371.025 -1.751750e-04   
303 2025-04-17 12:01:30   371.00    370.95    370.975 -1.347709e-04   
304 2025-04-17 12:02:00   371.01    371.16    371.085  2.964720e-04   
305 2025-04-17 12:02:30   370.99    370.93    370.960 -3.369068e-04   
306 2025-04-17 12:03:00   370.81    370.90    370.855 -2.830895e-04   
307 2025-04-17 12:03:30   370.89    370.96    370.925  1.887352e-04   
308 2025-04-17 12:04:00   370.84    370.98    370.910 -4.044026e-05   
309 2025-04-17 12:04:30   370.70    370.70    370.700 -5.663354e-04   
310 2025-04-17 12:05:00   370.49    371.77    371.130  1.159295e-03   
311 2025-04-17 12:05:30   371.52    371.99    371.755  1.682630e-03   
312 2025-04-17 12:06:00   371.70    372.11    371.905  4.034102e-04   
313 2025-04-17 12:06:30   371.48    371.79    371.635 -7.262555e-04   
314 2025-04-17 12:07:00   371.44    372.08    371.760  3.362950e-04   
315 2025-04-17 12:07:30   371.79    372.05    371.920  4.302926e-04   
316 2025-04-17 12:08:00   371.89    371.97    371.930  2.688714e-05   
317 2025-04-17 12:08:30   372.03    372.39    372.210  7.525466e-04   
318 2025-04-17 12:09:00   372.27    372.42    372.345  3.626327e-04   
319 2025-04-17 12:09:30   372.21    372.19    372.200 -3.894996e-04   
320 2025-04-17 12:10:00   371.91    372.07    371.990 -5.643720e-04   
321 2025-04-17 12:10:30   371.81    371.78    371.795 -5.243451e-04   
322 2025-04-17 12:11:00   371.60    372.00    371.800  1.344818e-05   
323 2025-04-17 12:11:30   371.80    371.85    371.825  6.723819e-05   
324 2025-04-17 12:12:00   370.97    371.66    371.315 -1.372555e-03   
325 2025-04-17 12:12:30   370.91    371.00    370.955 -9.699975e-04   
326 2025-04-17 12:13:00   370.68    370.83    370.755 -5.392943e-04   
327 2025-04-17 12:13:30   370.75    371.77    371.260  1.361159e-03   
328 2025-04-17 12:14:00   371.28    371.48    371.380  3.231714e-04   
329 2025-04-17 12:14:30   371.53    371.82    371.675  7.940193e-04   
330 2025-04-17 12:15:00   371.45    371.73    371.590 -2.287206e-04   
331 2025-04-17 12:15:30   371.57    371.92    371.745  4.170394e-04   
332 2025-04-17 12:16:00   371.89    372.02    371.955  5.647439e-04   
333 2025-04-17 12:16:30   371.95    372.11    372.030  2.016170e-04   
334 2025-04-17 12:17:00   371.84    372.16    372.000 -8.064191e-05   
335 2025-04-17 12:17:30   371.70    371.86    371.780 -5.915728e-04   
336 2025-04-17 12:18:00   371.70    371.71    371.705 -2.017526e-04   
337 2025-04-17 12:18:30   371.74    371.79    371.765  1.614053e-04   
338 2025-04-17 12:19:00   371.88    372.24    372.060  7.931974e-04   
339 2025-04-17 12:19:30   372.25    372.23    372.240  4.836759e-04   
340 2025-04-17 12:20:00   372.10    372.13    372.115 -3.358613e-04   
341 2025-04-17 12:20:30   371.79    371.97    371.880 -6.317247e-04   
342 2025-04-17 12:21:00   371.88    372.12    372.000  3.226327e-04   
343 2025-04-17 12:21:30   372.06    372.19    372.125  3.359651e-04   
344 2025-04-17 12:22:00   372.02    372.07    372.045 -2.150046e-04   
345 2025-04-17 12:22:30   371.76    371.90    371.830 -5.780541e-04   
346 2025-04-17 12:23:00   371.74    371.71    371.725 -2.824270e-04   
347 2025-04-17 12:23:30   371.80    371.73    371.765  1.076006e-04   
348 2025-04-17 12:24:00   371.72    371.87    371.795  8.069288e-05   
349 2025-04-17 12:24:30   371.70    371.70    371.700 -2.555498e-04   
350 2025-04-17 12:25:00   371.67    371.76    371.715  4.035431e-05   
351 2025-04-17 12:25:30   371.66    371.83    371.745  8.070374e-05   
352 2025-04-17 12:26:00   371.62    371.76    371.690 -1.479618e-04   
353 2025-04-17 12:26:30   371.71    371.88    371.795  2.824536e-04   
354 2025-04-17 12:27:00   371.89    371.84    371.865  1.882581e-04   
355 2025-04-17 12:27:30   371.85    371.86    371.855 -2.689184e-05   
356 2025-04-17 12:28:00   371.86    371.86    371.860  1.344601e-05   
357 2025-04-17 12:28:30   371.90    372.05    371.975  3.092084e-04   
358 2025-04-17 12:29:00   372.04    372.14    372.090  3.091128e-04   
359 2025-04-17 12:29:30   371.91    372.06    371.985 -2.822296e-04   
360 2025-04-17 12:30:00   371.65    371.85    371.750 -6.319455e-04   
361 2025-04-17 12:30:30   371.53    371.63    371.580 -4.574012e-04   
362 2025-04-17 12:31:00   371.45    371.53    371.490 -2.422383e-04   
363 2025-04-17 12:31:30   371.51    371.69    371.600  2.960610e-04   
364 2025-04-17 12:32:00   371.57    371.61    371.590 -2.691102e-05   
365 2025-04-17 12:32:30   371.46    371.52    371.490 -2.691500e-04   
366 2025-04-17 12:33:00   371.58    371.96    371.770  7.534376e-04   
367 2025-04-17 12:33:30   372.05    372.01    372.030  6.991127e-04   
368 2025-04-17 12:34:00   371.98    372.05    372.015 -4.032014e-05   
369 2025-04-17 12:34:30   371.93    371.84    371.885 -3.495093e-04   
370 2025-04-17 12:35:00   371.93    372.11    372.020  3.629496e-04   
371 2025-04-17 12:35:30   371.96    372.04    372.000 -5.376200e-05   
372 2025-04-17 12:36:00   371.96    371.91    371.935 -1.747465e-04   
373 2025-04-17 12:36:30   371.66    371.81    371.735 -5.378730e-04   
374 2025-04-17 12:37:00   371.38    371.52    371.450 -7.669692e-04   
375 2025-04-17 12:37:30   371.41    371.37    371.390 -1.615422e-04   
376 2025-04-17 12:38:00   371.29    371.40    371.345 -1.211738e-04   
377 2025-04-17 12:38:30   371.27    371.33    371.300 -1.211885e-04   
378 2025-04-17 12:39:00   371.32    371.35    371.335  9.425896e-05   
379 2025-04-17 12:39:30   371.06    371.24    371.150 -4.983266e-04   
380 2025-04-17 12:40:00   370.95    371.16    371.055 -2.559940e-04   
381 2025-04-17 12:40:30   371.02    371.06    371.040 -4.042609e-05   
382 2025-04-17 12:41:00   371.14    371.15    371.145  2.829483e-04   
383 2025-04-17 12:41:30   370.95    371.13    371.040 -2.829483e-04   
384 2025-04-17 12:42:00   370.64    370.85    370.745 -7.953788e-04   
385 2025-04-17 12:42:30   370.65    370.66    370.655 -2.427839e-04   
386 2025-04-17 12:43:00   370.18    370.63    370.405 -6.747092e-04   
387 2025-04-17 12:43:30   370.27    370.41    370.340 -1.754990e-04   
388 2025-04-17 12:44:00   370.07    370.13    370.100 -6.482632e-04   
389 2025-04-17 12:44:30   369.97    370.08    370.025 -2.026685e-04   
390 2025-04-17 12:45:00   369.91    370.00    369.955 -1.891943e-04   
391 2025-04-17 12:45:30   369.86    369.95    369.905 -1.351607e-04   
392 2025-04-17 12:46:00   369.95    370.18    370.065  4.324500e-04   
393 2025-04-17 12:46:30   370.21    370.25    370.230  4.457682e-04   
394 2025-04-17 12:47:00   370.33    370.28    370.305  2.025563e-04   
395 2025-04-17 12:47:30   370.31    370.31    370.310  1.350229e-05   
396 2025-04-17 12:48:00   370.27    370.24    370.255 -1.485352e-04   
397 2025-04-17 12:48:30   370.13    370.22    370.175 -2.160907e-04   
398 2025-04-17 12:49:00   369.90    370.02    369.960 -5.809751e-04   
399 2025-04-17 12:49:30   370.07    370.19    370.130  4.594036e-04   
400 2025-04-17 12:50:00   370.22    370.39    370.305  4.726951e-04   
401 2025-04-17 12:50:30   370.44    370.39    370.415  2.970083e-04   
402 2025-04-17 12:51:00   370.48    370.61    370.545  3.508961e-04   
403 2025-04-17 12:51:30   370.48    370.40    370.440 -2.834065e-04   
404 2025-04-17 12:52:00   370.38    370.59    370.485  1.214698e-04   
405 2025-04-17 12:52:30   370.72    370.92    370.820  9.038116e-04   
406 2025-04-17 12:53:00   370.96    371.16    371.060  6.470049e-04   
407 2025-04-17 12:53:30   371.29    371.20    371.245  4.984474e-04   
408 2025-04-17 12:54:00   371.36    371.33    371.345  2.693276e-04   
409 2025-04-17 12:54:30   371.37    371.32    371.345  0.000000e+00   
410 2025-04-17 12:55:00   371.24    371.39    371.315 -8.079067e-05   
411 2025-04-17 12:55:30   371.45    371.39    371.420  2.827388e-04   
412 2025-04-17 12:56:00   371.46    371.67    371.565  3.903174e-04   
413 2025-04-17 12:56:30   371.53    371.67    371.600  9.419173e-05   
414 2025-04-17 12:57:00   371.38    371.51    371.445 -4.172022e-04   
415 2025-04-17 12:57:30   371.42    371.37    371.395 -1.346185e-04   
416 2025-04-17 12:58:00   371.46    371.44    371.450  1.480793e-04   
417 2025-04-17 12:58:30   371.50    371.53    371.515  1.749746e-04   
418 2025-04-17 12:59:00   371.51    371.53    371.520  1.345832e-05   
419 2025-04-17 12:59:30   371.52    371.45    371.485 -9.421202e-05   
420 2025-04-17 13:00:00   371.42    371.51    371.465 -5.383942e-05   
421 2025-04-17 13:00:30   371.45    371.74    371.595  3.499045e-04   
422 2025-04-17 13:01:00   371.72    371.73    371.725  3.497821e-04   
423 2025-04-17 13:01:30   371.59    371.68    371.635 -2.421438e-04   
424 2025-04-17 13:02:00   371.71    371.66    371.685  1.345316e-04   
425 2025-04-17 13:02:30   371.67    371.66    371.665 -5.381045e-05   
426 2025-04-17 13:03:00   371.45    371.61    371.530 -3.632963e-04   
427 2025-04-17 13:03:30   371.39    371.34    371.365 -4.442081e-04   
428 2025-04-17 13:04:00   371.32    371.32    371.320 -1.211819e-04   
429 2025-04-17 13:04:30   371.32    371.46    371.390  1.884989e-04   
430 2025-04-17 13:05:00   371.53    371.37    371.450  1.615422e-04   
431 2025-04-17 13:05:30   371.34    371.37    371.355 -2.557872e-04   
432 2025-04-17 13:06:00   371.23    371.28    371.255 -2.693204e-04   
433 2025-04-17 13:06:30   371.20    371.12    371.160 -2.559216e-04   
434 2025-04-17 13:07:00   371.20    371.24    371.220  1.616423e-04   
435 2025-04-17 13:07:30   371.33    371.32    371.325  2.828111e-04   
436 2025-04-17 13:08:00   371.37    371.35    371.360  9.425261e-05   
437 2025-04-17 13:08:30   371.40    371.50    371.450  2.423231e-04   
438 2025-04-17 13:09:00   371.46    371.67    371.565  3.095496e-04   
439 2025-04-17 13:09:30   371.59    371.70    371.645  2.152824e-04   
440 2025-04-17 13:10:00   371.50    371.51    371.505 -3.767745e-04   
441 2025-04-17 13:10:30   371.56    371.64    371.600  2.556839e-04   
442 2025-04-17 13:11:00   371.25    371.43    371.340 -6.999220e-04   
443 2025-04-17 13:11:30   371.19    371.13    371.160 -4.848485e-04   
444 2025-04-17 13:12:00   371.13    371.18    371.155 -1.347137e-05   
445 2025-04-17 13:12:30   371.00    371.18    371.090 -1.751443e-04   
446 2025-04-17 13:13:00   371.04    371.05    371.045 -1.212717e-04   
447 2025-04-17 13:13:30   371.14    371.07    371.105  1.616924e-04   
448 2025-04-17 13:14:00   370.85    371.07    370.960 -3.908013e-04   
449 2025-04-17 13:14:30   370.84    370.78    370.810 -4.044380e-04   
450 2025-04-17 13:15:00   370.84    370.96    370.900  2.426825e-04   
451 2025-04-17 13:15:30   370.99    370.96    370.975  2.021904e-04   
452 2025-04-17 13:16:00   370.68    370.93    370.805 -4.583569e-04   
453 2025-04-17 13:16:30   370.73    370.72    370.725 -2.157701e-04   
454 2025-04-17 13:17:00   370.77    370.63    370.700 -6.743770e-05   
455 2025-04-17 13:17:30   370.64    370.63    370.635 -1.753593e-04   
456 2025-04-17 13:18:00   370.57    370.59    370.580 -1.484050e-04   
457 2025-04-17 13:18:30   370.65    370.56    370.605  6.745954e-05   
458 2025-04-17 13:19:00   370.64    370.70    370.670  1.753735e-04   
459 2025-04-17 13:19:30   370.74    370.70    370.720  1.348818e-04   
460 2025-04-17 13:20:00   370.68    370.71    370.695 -6.743861e-05   
461 2025-04-17 13:20:30   370.65    370.63    370.640 -1.483810e-04   
462 2025-04-17 13:21:00   370.49    370.56    370.525 -3.103223e-04   
463 2025-04-17 13:21:30   370.43    370.55    370.490 -9.446502e-05   
464 2025-04-17 13:22:00   370.50    370.46    370.480 -2.699165e-05   
465 2025-04-17 13:22:30   370.49    370.49    370.490  2.699165e-05   
466 2025-04-17 13:23:00   370.53    370.56    370.545  1.484410e-04   
467 2025-04-17 13:23:30   370.54    370.48    370.510 -9.445993e-05   
468 2025-04-17 13:24:00   370.52    370.43    370.475 -9.446885e-05   
469 2025-04-17 13:24:30   370.54    370.62    370.580  2.833798e-04   
470 2025-04-17 13:25:00   370.74    370.86    370.800  5.934878e-04   
471 2025-04-17 13:25:30   370.92    370.83    370.875  2.022449e-04   
472 2025-04-17 13:26:00   370.68    370.81    370.745 -3.505839e-04   
473 2025-04-17 13:26:30   370.54    370.63    370.585 -4.316566e-04   
474 2025-04-17 13:27:00   370.48    370.47    370.475 -2.968721e-04   
475 2025-04-17 13:27:30   370.50    370.61    370.555  2.159157e-04   
476 2025-04-17 13:28:00   370.63    370.63    370.630  2.023786e-04   
477 2025-04-17 13:28:30   370.73    370.77    370.750  3.237206e-04   
478 2025-04-17 13:29:00   370.53    370.62    370.575 -4.721276e-04   
479 2025-04-17 13:29:30   370.41    370.40    370.405 -4.588518e-04   
480 2025-04-17 13:30:00   370.41    370.59    370.500  2.564431e-04   
481 2025-04-17 13:30:30   370.49    370.64    370.565  1.754232e-04   
482 2025-04-17 13:31:00   370.52    370.67    370.595  8.095418e-05   
483 2025-04-17 13:31:30   370.74    370.73    370.735  3.776995e-04   
484 2025-04-17 13:32:00   370.77    370.89    370.830  2.562149e-04   
485 2025-04-17 13:32:30   370.77    370.88    370.825 -1.348336e-05   
486 2025-04-17 13:33:00   370.79    370.79    370.790 -9.438860e-05   
487 2025-04-17 13:33:30   370.90    370.98    370.940  4.044598e-04   
488 2025-04-17 13:34:00   371.06    371.11    371.085  3.908224e-04   
489 2025-04-17 13:34:30   371.04    370.99    371.015 -1.886538e-04   
490 2025-04-17 13:35:00   371.08    371.09    371.085  1.886538e-04   
491 2025-04-17 13:35:30   370.92    371.03    370.975 -2.964720e-04   
492 2025-04-17 13:36:00   370.92    371.03    370.975  0.000000e+00   
493 2025-04-17 13:36:30   371.01    371.05    371.030  1.482470e-04   
494 2025-04-17 13:37:00   371.05    371.14    371.095  1.751726e-04   
495 2025-04-17 13:37:30   371.04    370.98    371.010 -2.290781e-04   
496 2025-04-17 13:38:00   371.04    371.21    371.125  3.099167e-04   
497 2025-04-17 13:38:30   371.13    371.05    371.090 -9.431230e-05   
498 2025-04-17 13:39:00   371.02    371.10    371.060 -8.084619e-05   
499 2025-04-17 13:39:30   371.20    371.13    371.165  2.829331e-04   
500 2025-04-17 13:40:00   371.13    371.24    371.185  5.388294e-05   
501 2025-04-17 13:40:30   371.02    371.03    371.025 -4.311448e-04   
502 2025-04-17 13:41:00   371.04    370.98    371.010 -4.042936e-05   
503 2025-04-17 13:41:30   370.91    370.91    370.910 -2.695708e-04   
504 2025-04-17 13:42:00   370.67    370.78    370.725 -4.988977e-04   
505 2025-04-17 13:42:30   370.56    370.57    370.565 -4.316799e-04   
506 2025-04-17 13:43:00   370.58    370.62    370.600  9.444591e-05   
507 2025-04-17 13:43:30   370.66    370.67    370.665  1.753759e-04   
508 2025-04-17 13:44:00   370.76    370.95    370.855  5.124609e-04   
509 2025-04-17 13:44:30   370.91    370.92    370.915  1.617752e-04   
510 2025-04-17 13:45:00   370.89    370.96    370.925  2.695999e-05   
511 2025-04-17 13:45:30   371.01    371.04    371.025  2.695599e-04   
512 2025-04-17 13:46:00   371.12    371.40    371.260  6.331800e-04   
513 2025-04-17 13:46:30   371.42    371.51    371.465  5.520213e-04   
514 2025-04-17 13:47:00   371.59    371.80    371.695  6.189784e-04   
515 2025-04-17 13:47:30   371.81    371.78    371.795  2.690016e-04   
516 2025-04-17 13:48:00   371.73    371.83    371.780 -4.034563e-05   
517 2025-04-17 13:48:30   371.56    371.61    371.585 -5.246413e-04   
518 2025-04-17 13:49:00   371.56    371.52    371.540 -1.211102e-04   
519 2025-04-17 13:49:30   371.35    371.43    371.390 -4.038066e-04   
520 2025-04-17 13:50:00   371.39    371.50    371.445  1.480813e-04   
521 2025-04-17 13:50:30   371.50    371.52    371.510  1.749770e-04   
522 2025-04-17 13:51:00   371.63    371.72    371.675  4.440348e-04   
523 2025-04-17 13:51:30   371.55    371.60    371.575 -2.690885e-04   
524 2025-04-17 13:52:00   371.76    371.78    371.770  5.246555e-04   
525 2025-04-17 13:52:30   371.68    371.71    371.695 -2.017580e-04   
526 2025-04-17 13:53:00   371.55    371.77    371.660 -9.416766e-05   
527 2025-04-17 13:53:30   371.47    371.64    371.555 -2.825562e-04   
528 2025-04-17 13:54:00   371.62    371.60    371.610  1.480156e-04   
529 2025-04-17 13:54:30   371.42    371.53    371.475 -3.633501e-04   
530 2025-04-17 13:55:00   371.42    371.58    371.500  6.729702e-05   
531 2025-04-17 13:55:30   371.68    371.72    371.700  5.382131e-04   
532 2025-04-17 13:56:00   371.67    371.65    371.660 -1.076195e-04   
533 2025-04-17 13:56:30   371.42    371.55    371.485 -4.709714e-04   
534 2025-04-17 13:57:00   371.36    371.35    371.355 -3.500081e-04   
535 2025-04-17 13:57:30   371.35    371.30    371.325 -8.078850e-05   
536 2025-04-17 13:58:00   371.16    371.21    371.185 -3.770993e-04   
537 2025-04-17 13:58:30   371.23    371.22    371.225  1.077572e-04   
538 2025-04-17 13:59:00   371.10    371.11    371.105 -3.233063e-04   
539 2025-04-17 13:59:30   371.12    371.00    371.060 -1.212668e-04   
540 2025-04-17 14:00:00   370.95    370.99    370.970 -2.425778e-04   
541 2025-04-17 14:00:30   371.01    371.07    371.040  1.886767e-04   
542 2025-04-17 14:01:00   371.01    371.09    371.050  2.695091e-05   
543 2025-04-17 14:01:30   371.12    371.00    371.060  2.695018e-05   
544 2025-04-17 14:02:00   370.96    371.00    370.980 -2.156218e-04   
545 2025-04-17 14:02:30   370.94    371.01    370.975 -1.347791e-05   
546 2025-04-17 14:03:00   370.97    371.01    370.990  4.043317e-05   
547 2025-04-17 14:03:30   370.97    371.21    371.090  2.695127e-04   
548 2025-04-17 14:04:00   371.31    371.33    371.320  6.196037e-04   
549 2025-04-17 14:04:30   371.44    371.62    371.530  5.653901e-04   
550 2025-04-17 14:05:00   371.66    371.73    371.695  4.440109e-04   
551 2025-04-17 14:05:30   371.69    371.71    371.700  1.345180e-05   
552 2025-04-17 14:06:00   371.52    371.64    371.580 -3.228931e-04   
553 2025-04-17 14:06:30   371.50    371.55    371.525 -1.480275e-04   
554 2025-04-17 14:07:00   371.43    371.57    371.500 -6.729249e-05   
555 2025-04-17 14:07:30   371.50    371.46    371.480 -5.383725e-05   
556 2025-04-17 14:08:00   371.49    371.60    371.545  1.749605e-04   
557 2025-04-17 14:08:30   371.58    371.73    371.655  2.960172e-04   
558 2025-04-17 14:09:00   371.54    371.62    371.580 -2.018204e-04   
559 2025-04-17 14:09:30   371.55    371.50    371.525 -1.480275e-04   
560 2025-04-17 14:10:00   371.51    371.58    371.545  5.383073e-05   
561 2025-04-17 14:10:30   371.60    371.63    371.615  1.883847e-04   
562 2025-04-17 14:11:00   371.50    371.60    371.550 -1.749275e-04   
563 2025-04-17 14:11:30   371.41    371.54    371.475 -2.018775e-04   
564 2025-04-17 14:12:00   371.41    371.41    371.410 -1.749934e-04   
565 2025-04-17 14:12:30   371.25    371.40    371.325 -2.288838e-04   
566 2025-04-17 14:13:00   371.00    371.13    371.065 -7.004405e-04   
567 2025-04-17 14:13:30   370.92    370.99    370.955 -2.964880e-04   
568 2025-04-17 14:14:00   370.90    370.92    370.910 -1.213159e-04   
569 2025-04-17 14:14:30   370.90    370.92    370.910  0.000000e+00   
570 2025-04-17 14:15:00   370.76    370.86    370.810 -2.696435e-04   
571 2025-04-17 14:15:30   370.79    370.80    370.795 -4.045280e-05   
572 2025-04-17 14:16:00   370.59    370.68    370.635 -4.315984e-04   
573 2025-04-17 14:16:30   370.56    370.52    370.540 -2.563497e-04   
574 2025-04-17 14:17:00   370.56    370.66    370.610  1.888956e-04   
575 2025-04-17 14:17:30   370.73    370.95    370.840  6.204060e-04   
576 2025-04-17 14:18:00   370.96    371.01    370.985  3.909278e-04   
577 2025-04-17 14:18:30   370.79    370.88    370.835 -4.044108e-04   
578 2025-04-17 14:19:00   370.87    371.23    371.050  5.796047e-04   
579 2025-04-17 14:19:30   371.36    371.32    371.340  7.812606e-04   
580 2025-04-17 14:20:00   371.23    371.27    371.250 -2.423949e-04   
581 2025-04-17 14:20:30   371.20    371.36    371.280  8.080482e-05   
582 2025-04-17 14:21:00   371.41    371.51    371.460  4.846918e-04   
583 2025-04-17 14:21:30   371.48    371.37    371.425 -9.422724e-05   
584 2025-04-17 14:22:00   371.43    371.57    371.500  2.019046e-04   
585 2025-04-17 14:22:30   371.56    371.45    371.505  1.345886e-05   
586 2025-04-17 14:23:00   371.58    371.50    371.540  9.420695e-05   
587 2025-04-17 14:23:30   371.58    371.62    371.600  1.614770e-04   
588 2025-04-17 14:24:00   371.52    371.54    371.530 -1.883923e-04   
589 2025-04-17 14:24:30   371.51    371.54    371.525 -1.345795e-05   
590 2025-04-17 14:25:00   371.39    371.55    371.470 -1.480494e-04   
591 2025-04-17 14:25:30   371.48    371.55    371.515  1.211330e-04   
592 2025-04-17 14:26:00   371.02    371.41    371.215 -8.078306e-04   
593 2025-04-17 14:26:30   370.90    370.86    370.880 -9.028494e-04   
594 2025-04-17 14:27:00   370.86    370.94    370.900  5.392434e-05   
595 2025-04-17 14:27:30   370.92    370.88    370.900  0.000000e+00   
596 2025-04-17 14:28:00   370.92    371.02    370.970  1.887123e-04   
597 2025-04-17 14:28:30   370.98    370.91    370.945 -6.739317e-05   
598 2025-04-17 14:29:00   370.78    370.86    370.820 -3.370340e-04   
599 2025-04-17 14:29:30   370.64    370.72    370.680 -3.776130e-04   
600 2025-04-17 14:30:00   370.64    370.85    370.745  1.753380e-04   
601 2025-04-17 14:30:30   370.71    370.80    370.755  2.697235e-05   
602 2025-04-17 14:31:00   370.75    370.94    370.845  2.427184e-04   
603 2025-04-17 14:31:30   370.99    371.04    371.015  4.583075e-04   
604 2025-04-17 14:32:00   371.00    371.06    371.030  4.042881e-05   
605 2025-04-17 14:32:30   370.99    370.98    370.985 -1.212913e-04   
606 2025-04-17 14:33:00   370.91    370.98    370.945 -1.078269e-04   
607 2025-04-17 14:33:30   370.86    370.86    370.860 -2.291707e-04   
608 2025-04-17 14:34:00   370.67    370.81    370.740 -3.236246e-04   
609 2025-04-17 14:34:30   370.49    370.60    370.545 -5.261135e-04   
610 2025-04-17 14:35:00   370.50    370.51    370.505 -1.079549e-04   
611 2025-04-17 14:35:30   370.59    370.63    370.610  2.833568e-04   
612 2025-04-17 14:36:00   370.56    370.65    370.605 -1.349136e-05   
613 2025-04-17 14:36:30   370.43    370.47    370.450 -4.183225e-04   
614 2025-04-17 14:37:00   370.43    370.52    370.475  6.748321e-05   
615 2025-04-17 14:37:30   370.51    370.41    370.460 -4.048938e-05   
616 2025-04-17 14:38:00   370.54    370.46    370.500  1.079680e-04   
617 2025-04-17 14:38:30   370.60    370.57    370.585  2.293934e-04   
618 2025-04-17 14:39:00   370.57    370.57    370.570 -4.047736e-05   
619 2025-04-17 14:39:30   370.63    370.65    370.640  1.888803e-04   
620 2025-04-17 14:40:00   370.68    370.68    370.680  1.079156e-04   
621 2025-04-17 14:40:30   370.50    370.63    370.565 -3.102888e-04   
622 2025-04-17 14:41:00   370.44    370.45    370.445 -3.238823e-04   
623 2025-04-17 14:41:30   370.44    370.58    370.510  1.754493e-04   
624 2025-04-17 14:42:00   370.49    370.59    370.540  8.096620e-05   
625 2025-04-17 14:42:30   370.54    370.55    370.545  1.349373e-05   
626 2025-04-17 14:43:00   370.52    370.48    370.500 -1.214501e-04   
627 2025-04-17 14:43:30   370.53    370.48    370.505  1.349519e-05   
628 2025-04-17 14:44:00   370.51    370.61    370.560  1.484350e-04   
629 2025-04-17 14:44:30   370.68    370.83    370.755  5.260922e-04   
630 2025-04-17 14:45:00   370.78    370.85    370.815  1.618188e-04   
631 2025-04-17 14:45:30   370.61    370.77    370.690 -3.371521e-04   
632 2025-04-17 14:46:00   370.90    370.90    370.900  5.663507e-04   
633 2025-04-17 14:46:30   369.81    370.87    370.340 -1.510982e-03   
634 2025-04-17 14:47:00   370.47    370.68    370.575  6.343508e-04   
635 2025-04-17 14:47:30   370.36    370.64    370.500 -2.024087e-04   
636 2025-04-17 14:48:00   370.11    370.29    370.200 -8.100446e-04   
637 2025-04-17 14:48:30   370.09    370.54    370.315  3.105947e-04   
638 2025-04-17 14:49:00   370.29    370.48    370.385  1.890104e-04   
639 2025-04-17 14:49:30   370.19    370.16    370.175 -5.671384e-04   
640 2025-04-17 14:50:00   369.67    370.05    369.860 -8.513111e-04   
641 2025-04-17 14:50:30   369.73    369.84    369.785 -2.028000e-04   
642 2025-04-17 14:51:00   369.74    369.74    369.740 -1.216997e-04   
643 2025-04-17 14:51:30   369.75    369.87    369.810  1.893043e-04   
644 2025-04-17 14:52:00   369.92    370.13    370.025  5.812107e-04   
645 2025-04-17 14:52:30   370.19    370.24    370.215  5.133470e-04   
646 2025-04-17 14:53:00   370.30    370.28    370.290  2.025645e-04   
647 2025-04-17 14:53:30   370.28    370.30    370.290  0.000000e+00   
648 2025-04-17 14:54:00   370.13    370.27    370.200 -2.430823e-04   
649 2025-04-17 14:54:30   370.00    370.09    370.045 -4.187803e-04   
650 2025-04-17 14:55:00   369.92    369.93    369.925 -3.243375e-04   
651 2025-04-17 14:55:30   369.98    369.93    369.955  8.109423e-05   
652 2025-04-17 14:56:00   369.86    369.90    369.880 -2.027479e-04   
653 2025-04-17 14:56:30   369.75    369.79    369.770 -2.974380e-04   
654 2025-04-17 14:57:00   369.72    369.77    369.745 -6.761188e-05   
655 2025-04-17 14:57:30   369.75    369.80    369.775  8.113371e-05   
656 2025-04-17 14:58:00   369.72    369.79    369.755 -5.408841e-05   
657 2025-04-17 14:58:30   369.66    369.69    369.675 -2.163829e-04   
658 2025-04-17 14:59:00   369.63    369.74    369.685  2.705042e-05   
659 2025-04-17 14:59:30   369.44    369.51    369.475 -5.682126e-04   
660 2025-04-17 15:00:00   369.35    369.54    369.445 -8.119959e-05   
661 2025-04-17 15:00:30   369.35    369.40    369.375 -1.894914e-04   
662 2025-04-17 15:01:00   369.38    369.37    369.375  0.000000e+00   
663 2025-04-17 15:01:30   369.21    369.28    369.245 -3.520078e-04   
664 2025-04-17 15:02:00   369.28    369.42    369.350  2.843236e-04   
665 2025-04-17 15:02:30   369.32    369.36    369.340 -2.707496e-05   
666 2025-04-17 15:03:00   369.14    369.38    369.260 -2.166261e-04   
667 2025-04-17 15:03:30   369.13    369.22    369.175 -2.302166e-04   
668 2025-04-17 15:04:00   369.25    369.28    369.265  2.437571e-04   
669 2025-04-17 15:04:30   369.30    369.27    369.285  5.416018e-05   
670 2025-04-17 15:05:00   368.96    369.26    369.110 -4.740011e-04   
671 2025-04-17 15:05:30   369.02    369.10    369.060 -1.354701e-04   
672 2025-04-17 15:06:00   369.01    369.11    369.060  0.000000e+00   
673 2025-04-17 15:06:30   369.11    369.13    369.120  1.625620e-04   
674 2025-04-17 15:07:00   369.13    369.23    369.180  1.625356e-04   
675 2025-04-17 15:07:30   369.01    369.23    369.120 -1.625356e-04   
676 2025-04-17 15:08:00   368.98    369.08    369.030 -2.438529e-04   
677 2025-04-17 15:08:30   369.09    369.05    369.070  1.083864e-04   
678 2025-04-17 15:09:00   369.11    369.15    369.130  1.625576e-04   
679 2025-04-17 15:09:30   369.19    369.19    369.190  1.625312e-04   
680 2025-04-17 15:10:00   369.04    369.19    369.115 -2.031681e-04   
681 2025-04-17 15:10:30   369.01    369.05    369.030 -2.303071e-04   
682 2025-04-17 15:11:00   369.03    369.09    369.060  8.129090e-05   
683 2025-04-17 15:11:30   369.02    368.99    369.005 -1.490384e-04   
684 2025-04-17 15:12:00   368.77    368.98    368.875 -3.523608e-04   
685 2025-04-17 15:12:30   368.63    368.71    368.670 -5.558983e-04   
686 2025-04-17 15:13:00   368.62    368.64    368.630 -1.085040e-04   
687 2025-04-17 15:13:30   368.53    368.66    368.595 -9.495066e-05   
688 2025-04-17 15:14:00   368.42    368.59    368.505 -2.442002e-04   
689 2025-04-17 15:14:30   368.33    368.36    368.345 -4.342811e-04   
690 2025-04-17 15:15:00   368.14    368.28    368.210 -3.665714e-04   
691 2025-04-17 15:15:30   368.14    368.35    368.245  9.504994e-05   
692 2025-04-17 15:16:00   368.17    368.32    368.245  0.000000e+00   
693 2025-04-17 15:16:30   368.16    368.26    368.210 -9.504994e-05   
694 2025-04-17 15:17:00   368.00    368.18    368.090 -3.259541e-04   
695 2025-04-17 15:17:30   368.15    368.23    368.190  2.716358e-04   
696 2025-04-17 15:18:00   368.16    368.23    368.195  1.357985e-05   
697 2025-04-17 15:18:30   368.07    368.20    368.135 -1.629704e-04   
698 2025-04-17 15:19:00   368.17    368.30    368.235  2.716026e-04   
699 2025-04-17 15:19:30   368.36    368.41    368.385  4.072656e-04   
700 2025-04-17 15:20:00   368.28    368.49    368.385  0.000000e+00   
701 2025-04-17 15:20:30   368.13    368.24    368.185 -5.430577e-04   
702 2025-04-17 15:21:00   368.00    368.07    368.035 -4.074869e-04   
703 2025-04-17 15:21:30   367.83    367.96    367.895 -3.804710e-04   
704 2025-04-17 15:22:00   367.78    368.05    367.915  5.436186e-05   
705 2025-04-17 15:22:30   367.98    368.05    368.015  2.717650e-04   
706 2025-04-17 15:23:00   367.96    368.18    368.070  1.494393e-04   
707 2025-04-17 15:23:30   368.23    368.49    368.360  7.875834e-04   
708 2025-04-17 15:24:00   368.45    368.58    368.515  4.206955e-04   
709 2025-04-17 15:24:30   368.39    368.45    368.420 -2.578246e-04   
710 2025-04-17 15:25:00   368.22    368.32    368.270 -4.072269e-04   
711 2025-04-17 15:25:30   368.14    368.14    368.140 -3.530642e-04   
712 2025-04-17 15:26:00   368.15    368.41    368.280  3.802178e-04   
713 2025-04-17 15:26:30   368.47    368.46    368.465  5.022091e-04   
714 2025-04-17 15:27:00   368.48    368.61    368.545  2.170934e-04   
715 2025-04-17 15:27:30   368.58    368.67    368.625  2.170463e-04   
716 2025-04-17 15:28:00   368.71    368.87    368.790  4.475092e-04   
717 2025-04-17 15:28:30   368.63    368.76    368.695 -2.576324e-04   
718 2025-04-17 15:29:00   368.60    368.57    368.585 -2.983941e-04   
719 2025-04-17 15:29:30   368.40    368.55    368.475 -2.984832e-04   
720 2025-04-17 15:30:00   368.39    368.71    368.550  2.035209e-04   
721 2025-04-17 15:30:30   368.79    368.88    368.835  7.730019e-04   
722 2025-04-17 15:31:00   368.83    368.89    368.860  6.777869e-05   
723 2025-04-17 15:31:30   368.89    368.94    368.915  1.490969e-04   
724 2025-04-17 15:32:00   368.78    368.82    368.800 -3.117735e-04   
725 2025-04-17 15:32:30   368.51    368.74    368.625 -4.746245e-04   
726 2025-04-17 15:33:00   368.41    368.55    368.480 -3.934311e-04   
727 2025-04-17 15:33:30   368.51    368.58    368.545  1.763848e-04   
728 2025-04-17 15:34:00   368.45    368.47    368.460 -2.306633e-04   
729 2025-04-17 15:34:30   368.53    368.63    368.580  3.256268e-04   
730 2025-04-17 15:35:00   368.63    368.71    368.670  2.441506e-04   
731 2025-04-17 15:35:30   368.55    368.75    368.650 -5.425053e-05   
732 2025-04-17 15:36:00   368.58    368.64    368.610 -1.085099e-04   
733 2025-04-17 15:36:30   368.67    368.75    368.710  2.712526e-04   
734 2025-04-17 15:37:00   368.57    368.72    368.645 -1.763059e-04   
735 2025-04-17 15:37:30   368.45    368.54    368.495 -4.069783e-04   
736 2025-04-17 15:38:00   368.43    368.60    368.515  5.427335e-05   
737 2025-04-17 15:38:30   368.65    368.69    368.670  4.205186e-04   
738 2025-04-17 15:39:00   368.77    368.94    368.855  5.016779e-04   
739 2025-04-17 15:39:30   368.87    368.92    368.895  1.084378e-04   
740 2025-04-17 15:40:00   368.56    368.84    368.700 -5.287455e-04   
741 2025-04-17 15:40:30   368.42    368.43    368.425 -7.461421e-04   
742 2025-04-17 15:41:00   368.32    368.41    368.365 -1.628687e-04   
743 2025-04-17 15:41:30   368.33    368.43    368.380  4.071965e-05   
744 2025-04-17 15:42:00   368.46    368.66    368.560  4.885065e-04   
745 2025-04-17 15:42:30   368.76    368.87    368.815  6.916427e-04   
746 2025-04-17 15:43:00   368.52    368.74    368.630 -5.017323e-04   
747 2025-04-17 15:43:30   368.64    368.87    368.755  3.390359e-04   
748 2025-04-17 15:44:00   368.66    368.77    368.715 -1.084790e-04   
749 2025-04-17 15:44:30   368.77    368.78    368.775  1.627141e-04   
750 2025-04-17 15:45:00   368.68    368.78    368.730 -1.220331e-04   
751 2025-04-17 15:45:30   368.39    368.66    368.525 -5.561170e-04   
752 2025-04-17 15:46:00   368.22    368.34    368.280 -6.650335e-04   
753 2025-04-17 15:46:30   368.20    368.22    368.210 -1.900908e-04   
754 2025-04-17 15:47:00   367.90    368.12    368.010 -5.433159e-04   
755 2025-04-17 15:47:30   367.96    368.02    367.990 -5.434783e-05   
756 2025-04-17 15:48:00   368.04    368.09    368.065  2.037891e-04   
757 2025-04-17 15:48:30   367.93    368.03    367.980 -2.309641e-04   
758 2025-04-17 15:49:00   368.10    368.18    368.140  4.347117e-04   
759 2025-04-17 15:49:30   367.97    368.14    368.055 -2.309171e-04   
760 2025-04-17 15:50:00   367.44    367.92    367.680 -1.019389e-03   
761 2025-04-17 15:50:30   367.49    367.66    367.575 -2.856152e-04   
762 2025-04-17 15:51:00   367.36    367.57    367.465 -2.993034e-04   
763 2025-04-17 15:51:30   367.36    367.44    367.400 -1.769032e-04   
764 2025-04-17 15:52:00   367.36    367.49    367.425  6.804341e-05   
765 2025-04-17 15:52:30   367.41    367.53    367.470  1.224665e-04   
766 2025-04-17 15:53:00   367.11    367.33    367.220 -6.805592e-04   
767 2025-04-17 15:53:30   366.96    367.16    367.060 -4.358011e-04   
768 2025-04-17 15:54:00   367.20    367.58    367.390  8.986317e-04   
769 2025-04-17 15:54:30   367.56    368.02    367.790  1.088169e-03   
770 2025-04-17 15:55:00   367.86    368.23    368.045  6.930902e-04   
771 2025-04-17 15:55:30   367.63    367.88    367.755 -7.882577e-04   
772 2025-04-17 15:56:00   367.33    367.63    367.480 -7.480602e-04   
773 2025-04-17 15:56:30   367.35    367.53    367.440 -1.088554e-04   
774 2025-04-17 15:57:00   367.43    367.54    367.485  1.224615e-04   
775 2025-04-17 15:57:30   367.37    367.54    367.455 -8.163932e-05   
776 2025-04-17 15:58:00   367.37    367.50    367.435 -5.442991e-05   
777 2025-04-17 15:58:30   367.22    367.40    367.310 -3.402541e-04   
778 2025-04-17 15:59:00   367.41    367.80    367.605  8.028140e-04   
779 2025-04-17 15:59:30   367.67    367.87    367.770  4.487506e-04   

     rolling_volatility  
30             0.000639  
31             0.000636  
32             0.000631  
33             0.000599  
34             0.000580  
35             0.000580  
36             0.000594  
37             0.000592  
38             0.000595  
39             0.000583  
40             0.000622  
41             0.000651  
42             0.000669  
43             0.000675  
44             0.000682  
45             0.000651  
46             0.000641  
47             0.000640  
48             0.000639  
49             0.000639  
50             0.000645  
51             0.000645  
52             0.000621  
53             0.000576  
54             0.000574  
55             0.000580  
56             0.000578  
57             0.000576  
58             0.000554  
59             0.000539  
60             0.000557  
61             0.000576  
62             0.000593  
63             0.000555  
64             0.000594  
65             0.000626  
66             0.000622  
67             0.000629  
68             0.000641  
69             0.000654  
70             0.000618  
71             0.000582  
72             0.000558  
73             0.000605  
74             0.000603  
75             0.000623  
76             0.000622  
77             0.000628  
78             0.000613  
79             0.000626  
80             0.000652  
81             0.000650  
82             0.000657  
83             0.000648  
84             0.000674  
85             0.000693  
86             0.000704  
87             0.000706  
88             0.000704  
89             0.000689  
90             0.000683  
91             0.000674  
92             0.000646  
93             0.000641  
94             0.000618  
95             0.000594  
96             0.000591  
97             0.000585  
98             0.000576  
99             0.000558  
100            0.000558  
101            0.000558  
102            0.000557  
103            0.000490  
104            0.000465  
105            0.000394  
106            0.000417  
107            0.000416  
108            0.000483  
109            0.000488  
110            0.000465  
111            0.000465  
112            0.000464  
113            0.000463  
114            0.000430  
115            0.000410  
116            0.000404  
117            0.000398  
118            0.000399  
119            0.000396  
120            0.000403  
121            0.000412  
122            0.000455  
123            0.000456  
124            0.000455  
125            0.000461  
126            0.000473  
127            0.000473  
128            0.000469  
129            0.000461  
130            0.000465  
131            0.000461  
132            0.000467  
133            0.000465  
134            0.000457  
135            0.000458  
136            0.000451  
137            0.000450  
138            0.000402  
139            0.000403  
140            0.000391  
141            0.000431  
142            0.000450  
143            0.000464  
144            0.000467  
145            0.000450  
146            0.000457  
147            0.000456  
148            0.000458  
149            0.000464  
150            0.000457  
151            0.000447  
152            0.000404  
153            0.000403  
154            0.000403  
155            0.000392  
156            0.000384  
157            0.000384  
158            0.000384  
159            0.000370  
160            0.000372  
161            0.000381  
162            0.000364  
163            0.000369  
164            0.000369  
165            0.000349  
166            0.000356  
167            0.000355  
168            0.000341  
169            0.000338  
170            0.000331  
171            0.000303  
172            0.000282  
173            0.000269  
174            0.000295  
175            0.000296  
176            0.000278  
177            0.000288  
178            0.000284  
179            0.000274  
180            0.000275  
181            0.000276  
182            0.000268  
183            0.000281  
184            0.000283  
185            0.000283  
186            0.000280  
187            0.000281  
188            0.000282  
189            0.000291  
190            0.000277  
191            0.000285  
192            0.000400  
193            0.000534  
194            0.000564  
195            0.000553  
196            0.000550  
197            0.000552  
198            0.000562  
199            0.000564  
200            0.000564  
201            0.000570  
202            0.000573  
203            0.000576  
204            0.000560  
205            0.000560  
206            0.000564  
207            0.000556  
208            0.000556  
209            0.000551  
210            0.000552  
211            0.000563  
212            0.000570  
213            0.000566  
214            0.000560  
215            0.000574  
216            0.000577  
217            0.000576  
218            0.000588  
219            0.000592  
220            0.000595  
221            0.000613  
222            0.000566  
223            0.000447  
224            0.000404  
225            0.000405  
226            0.000404  
227            0.000399  
228            0.000394  
229            0.000396  
230            0.000399  
231            0.000383  
232            0.000371  
233            0.000375  
234            0.000378  
235            0.000375  
236            0.000379  
237            0.000378  
238            0.000364  
239            0.000363  
240            0.000368  
241            0.000378  
242            0.000392  
243            0.000396  
244            0.000397  
245            0.000360  
246            0.000335  
247            0.000307  
248            0.000303  
249            0.000302  
250            0.000319  
251            0.000324  
252            0.000321  
253            0.000329  
254            0.000339  
255            0.000410  
256            0.000417  
257            0.000452  
258            0.000449  
259            0.000447  
260            0.000446  
261            0.000441  
262            0.000441  
263            0.000455  
264            0.000456  
265            0.000453  
266            0.000452  
267            0.000450  
268            0.000453  
269            0.000456  
270            0.000457  
271            0.000454  
272            0.000447  
273            0.000443  
274            0.000446  
275            0.000447  
276            0.000452  
277            0.000452  
278            0.000467  
279            0.000483  
280            0.000472  
281            0.000457  
282            0.000462  
283            0.000492  
284            0.000502  
285            0.000446  
286            0.000478  
287            0.000451  
288            0.000452  
289            0.000452  
290            0.000449  
291            0.000470  
292            0.000479  
293            0.000464  
294            0.000459  
295            0.000461  
296            0.000459  
297            0.000458  
298            0.000450  
299            0.000448  
300            0.000461  
301            0.000455  
302            0.000452  
303            0.000450  
304            0.000449  
305            0.000452  
306            0.000445  
307            0.000447  
308            0.000426  
309            0.000418  
310            0.000465  
311            0.000551  
312            0.000552  
313            0.000548  
314            0.000537  
315            0.000540  
316            0.000493  
317            0.000502  
318            0.000499  
319            0.000509  
320            0.000524  
321            0.000525  
322            0.000520  
323            0.000519  
324            0.000582  
325            0.000607  
326            0.000613  
327            0.000662  
328            0.000663  
329            0.000677  
330            0.000669  
331            0.000673  
332            0.000677  
333            0.000676  
334            0.000676  
335            0.000683  
336            0.000682  
337            0.000682  
338            0.000694  
339            0.000685  
340            0.000662  
341            0.000602  
342            0.000601  
343            0.000587  
344            0.000586  
345            0.000591  
346            0.000593  
347            0.000576  
348            0.000571  
349            0.000569  
350            0.000561  
351            0.000553  
352            0.000553  
353            0.000556  
354            0.000493  
355            0.000454  
356            0.000439  
357            0.000371  
358            0.000371  
359            0.000349  
360            0.000367  
361            0.000368  
362            0.000354  
363            0.000357  
364            0.000356  
365            0.000344  
366            0.000370  
367            0.000390  
368            0.000362  
369            0.000356  
370            0.000358  
371            0.000338  
372            0.000335  
373            0.000342  
374            0.000366  
375            0.000353  
376            0.000350  
377            0.000350  
378            0.000350  
379            0.000358  
380            0.000359  
381            0.000358  
382            0.000363  
383            0.000360  
384            0.000380  
385            0.000381  
386            0.000394  
387            0.000385  
388            0.000386  
389            0.000385  
390            0.000375  
391            0.000371  
392            0.000386  
393            0.000392  
394            0.000396  
395            0.000396  
396            0.000361  
397            0.000325  
398            0.000333  
399            0.000351  
400            0.000357  
401            0.000366  
402            0.000377  
403            0.000370  
404            0.000351  
405            0.000395  
406            0.000414  
407            0.000425  
408            0.000427  
409            0.000417  
410            0.000414  
411            0.000417  
412            0.000419  
413            0.000415  
414            0.000394  
415            0.000391  
416            0.000365  
417            0.000362  
418            0.000334  
419            0.000331  
420            0.000327  
421            0.000325  
422            0.000323  
423            0.000326  
424            0.000325  
425            0.000326  
426            0.000335  
427            0.000345  
428            0.000323  
429            0.000317  
430            0.000310  
431            0.000314  
432            0.000316  
433            0.000315  
434            0.000316  
435            0.000277  
436            0.000253  
437            0.000240  
438            0.000242  
439            0.000244  
440            0.000255  
441            0.000254  
442            0.000275  
443            0.000287  
444            0.000278  
445            0.000279  
446            0.000277  
447            0.000277  
448            0.000284  
449            0.000291  
450            0.000297  
451            0.000291  
452            0.000289  
453            0.000289  
454            0.000286  
455            0.000286  
456            0.000282  
457            0.000275  
458            0.000278  
459            0.000277  
460            0.000274  
461            0.000272  
462            0.000273  
463            0.000271  
464            0.000268  
465            0.000260  
466            0.000261  
467            0.000255  
468            0.000243  
469            0.000247  
470            0.000271  
471            0.000269  
472            0.000247  
473            0.000244  
474            0.000248  
475            0.000252  
476            0.000256  
477            0.000262  
478            0.000266  
479            0.000269  
480            0.000269  
481            0.000269  
482            0.000257  
483            0.000264  
484            0.000268  
485            0.000266  
486            0.000265  
487            0.000274  
488            0.000281  
489            0.000283  
490            0.000284  
491            0.000288  
492            0.000281  
493            0.000281  
494            0.000281  
495            0.000286  
496            0.000289  
497            0.000289  
498            0.000289  
499            0.000289  
500            0.000271  
501            0.000282  
502            0.000273  
503            0.000265  
504            0.000276  
505            0.000286  
506            0.000284  
507            0.000279  
508            0.000281  
509            0.000266  
510            0.000263  
511            0.000266  
512            0.000287  
513            0.000295  
514            0.000310  
515            0.000312  
516            0.000311  
517            0.000324  
518            0.000319  
519            0.000327  
520            0.000326  
521            0.000321  
522            0.000329  
523            0.000334  
524            0.000345  
525            0.000344  
526            0.000342  
527            0.000346  
528            0.000346  
529            0.000351  
530            0.000351  
531            0.000352  
532            0.000353  
533            0.000361  
534            0.000354  
535            0.000343  
536            0.000353  
537            0.000352  
538            0.000347  
539            0.000347  
540            0.000350  
541            0.000348  
542            0.000327  
543            0.000309  
544            0.000285  
545            0.000278  
546            0.000279  
547            0.000272  
548            0.000297  
549            0.000307  
550            0.000316  
551            0.000314  
552            0.000310  
553            0.000307  
554            0.000290  
555            0.000288  
556            0.000290  
557            0.000291  
558            0.000292  
559            0.000285  
560            0.000285  
561            0.000269  
562            0.000271  
563            0.000259  
564            0.000253  
565            0.000256  
566            0.000278  
567            0.000282  
568            0.000277  
569            0.000276  
570            0.000277  
571            0.000274  
572            0.000284  
573            0.000287  
574            0.000288  
575            0.000312  
576            0.000320  
577            0.000324  
578            0.000322  
579            0.000337  
580            0.000328  
581            0.000329  
582            0.000337  
583            0.000337  
584            0.000339  
585            0.000339  
586            0.000338  
587            0.000334  
588            0.000334  
589            0.000333  
590            0.000334  
591            0.000333  
592            0.000362  
593            0.000395  
594            0.000395  
595            0.000393  
596            0.000375  
597            0.000371  
598            0.000376  
599            0.000382  
600            0.000380  
601            0.000380  
602            0.000374  
603            0.000378  
604            0.000377  
605            0.000362  
606            0.000355  
607            0.000350  
608            0.000337  
609            0.000313  
610            0.000311  
611            0.000316  
612            0.000300  
613            0.000306  
614            0.000303  
615            0.000302  
616            0.000302  
617            0.000305  
618            0.000304  
619            0.000308  
620            0.000310  
621            0.000310  
622            0.000283  
623            0.000238  
624            0.000239  
625            0.000239  
626            0.000236  
627            0.000236  
628            0.000231  
629            0.000242  
630            0.000242  
631            0.000250  
632            0.000267  
633            0.000373  
634            0.000394  
635            0.000395  
636            0.000419  
637            0.000423  
638            0.000422  
639            0.000424  
640            0.000449  
641            0.000445  
642            0.000445  
643            0.000443  
644            0.000457  
645            0.000469  
646            0.000470  
647            0.000467  
648            0.000469  
649            0.000472  
650            0.000474  
651            0.000472  
652            0.000470  
653            0.000470  
654            0.000470  
655            0.000470  
656            0.000470  
657            0.000471  
658            0.000469  
659            0.000463  
660            0.000460  
661            0.000459  
662            0.000441  
663            0.000359  
664            0.000340  
665            0.000340  
666            0.000314  
667            0.000306  
668            0.000308  
669            0.000296  
670            0.000269  
671            0.000268  
672            0.000268  
673            0.000267  
674            0.000242  
675            0.000215  
676            0.000209  
677            0.000212  
678            0.000216  
679            0.000212  
680            0.000208  
681            0.000208  
682            0.000209  
683            0.000205  
684            0.000212  
685            0.000226  
686            0.000226  
687            0.000225  
688            0.000226  
689            0.000217  
690            0.000223  
691            0.000225  
692            0.000225  
693            0.000220  
694            0.000212  
695            0.000223  
696            0.000223  
697            0.000222  
698            0.000223  
699            0.000240  
700            0.000229  
701            0.000245  
702            0.000251  
703            0.000252  
704            0.000248  
705            0.000258  
706            0.000260  
707            0.000304  
708            0.000314  
709            0.000313  
710            0.000319  
711            0.000321  
712            0.000331  
713            0.000347  
714            0.000345  
715            0.000333  
716            0.000342  
717            0.000345  
718            0.000347  
719            0.000342  
720            0.000336  
721            0.000362  
722            0.000362  
723            0.000361  
724            0.000361  
725            0.000372  
726            0.000380  
727            0.000379  
728            0.000379  
729            0.000377  
730            0.000379  
731            0.000364  
732            0.000355  
733            0.000348  
734            0.000351  
735            0.000359  
736            0.000358  
737            0.000338  
738            0.000341  
739            0.000337  
740            0.000343  
741            0.000365  
742            0.000361  
743            0.000349  
744            0.000358  
745            0.000378  
746            0.000380  
747            0.000383  
748            0.000379  
749            0.000375  
750            0.000375  
751            0.000361  
752            0.000378  
753            0.000377  
754            0.000385  
755            0.000377  
756            0.000374  
757            0.000374  
758            0.000382  
759            0.000378  
760            0.000413  
761            0.000415  
762            0.000416  
763            0.000410  
764            0.000412  
765            0.000410  
766            0.000422  
767            0.000414  
768            0.000441  
769            0.000492  
770            0.000506  
771            0.000508  
772            0.000523  
773            0.000523  
774            0.000513  
775            0.000491  
776            0.000486  
777            0.000480  
778            0.000509  
779            0.000517  </code></pre>
</div>
</div>
<div id="88238f1b3554f0f5" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2025-04-21T05:42:39.630594Z&quot;,&quot;start_time&quot;:&quot;2025-04-21T05:42:39.570871Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== TUNABLE PARAMETERS =====</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>gamma <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>tolerance_bps <span class="op">=</span> <span class="dv">150</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>initial_inventory <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>volatility_multiplier <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>min_time_diff <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> merged_df.copy()</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>inventory <span class="op">=</span> initial_inventory</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>cash_position <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>reservation_prices <span class="op">=</span> []</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>optimal_spreads <span class="op">=</span> []</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>blotter <span class="op">=</span> []</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Precompute constant term in optimal spread</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>constant_spread_term <span class="op">=</span> (<span class="dv">2</span> <span class="op">/</span> gamma) <span class="op">*</span> np.log(<span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">/</span> gamma)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>last_fill_time <span class="op">=</span> pd.to_datetime(df.iloc[<span class="dv">0</span>][<span class="st">'timestamp'</span>])</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># === Main Loop ===</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    current_time <span class="op">=</span> pd.to_datetime(row[<span class="st">'timestamp'</span>])</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    st <span class="op">=</span> row[<span class="st">'mid_price'</span>]</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    ask <span class="op">=</span> row[<span class="st">'ask_low'</span>]</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    bid <span class="op">=</span> row[<span class="st">'bid_high'</span>]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    variance <span class="op">=</span> (row[<span class="st">'rolling_volatility'</span>] <span class="op">*</span> volatility_multiplier) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    time_diff <span class="op">=</span> (current_time <span class="op">-</span> last_fill_time).total_seconds() <span class="op">/</span> <span class="dv">60</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    time_in_market <span class="op">=</span> <span class="bu">max</span>(time_diff, min_time_diff)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    rt <span class="op">=</span> st <span class="op">-</span> gamma <span class="op">*</span> inventory <span class="op">*</span> variance <span class="op">*</span> time_in_market</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    reservation_prices.append(rt)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    spread <span class="op">=</span> gamma <span class="op">*</span> variance <span class="op">*</span> time_in_market <span class="op">+</span> constant_spread_term</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    optimal_spreads.append(spread)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    tolerance <span class="op">=</span> (tolerance_bps <span class="op">/</span> <span class="dv">10000</span>) <span class="op">*</span> st</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    trade <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    fill_price <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rt <span class="op">&lt;</span> ask <span class="kw">and</span> <span class="bu">abs</span>(rt <span class="op">-</span> ask) <span class="op">&lt;=</span> tolerance:</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        trade <span class="op">=</span> <span class="st">'BUY'</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        fill_price <span class="op">=</span> ask</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        inventory <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        cash_position <span class="op">-=</span> fill_price</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>        last_fill_time <span class="op">=</span> current_time</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> rt <span class="op">&gt;</span> bid <span class="kw">and</span> <span class="bu">abs</span>(rt <span class="op">-</span> bid) <span class="op">&lt;=</span> tolerance:</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        trade <span class="op">=</span> <span class="st">'SELL'</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        fill_price <span class="op">=</span> bid</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        inventory <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        cash_position <span class="op">+=</span> fill_price</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>        last_fill_time <span class="op">=</span> current_time</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inventory rebalancing logic</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> inventory <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        inventory <span class="op">-=</span> <span class="dv">11</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>        fill_price <span class="op">=</span> bid  <span class="co"># use bid for sell</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        cash_position <span class="op">+=</span> bid <span class="op">*</span> <span class="dv">11</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        trade <span class="op">=</span> <span class="st">'SELL'</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>        last_fill_time <span class="op">=</span> current_time</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Portfolio value = cash + inventory Ã— mid price</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    portfolio_value <span class="op">=</span> cash_position <span class="op">+</span> inventory <span class="op">*</span> st</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> trade <span class="kw">and</span> fill_price <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>        blotter.append({</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'timestamp'</span>: current_time,</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">'trade'</span>: trade,</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">'fill_price'</span>: <span class="bu">round</span>(fill_price, <span class="dv">2</span>),</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">'reservation_price'</span>: <span class="bu">round</span>(rt, <span class="dv">2</span>),</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>            <span class="st">'inventory'</span>: inventory,</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>            <span class="st">'cash_position'</span>: <span class="bu">round</span>(cash_position, <span class="dv">3</span>),</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>            <span class="st">'portfolio_value'</span>: <span class="bu">round</span>(portfolio_value, <span class="dv">3</span>)</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign to main df</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'reservation_price'</span>] <span class="op">=</span> reservation_prices</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'optimal_spread'</span>] <span class="op">=</span> optimal_spreads</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Final blotter</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>blotter_df <span class="op">=</span> pd.DataFrame(blotter)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Display cleanly</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(blotter_df[[<span class="st">'timestamp'</span>, <span class="st">'trade'</span>, <span class="st">'fill_price'</span>, <span class="st">'inventory'</span>, <span class="st">'cash_position'</span>]])</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a><span class="co">#Save blotter to a CSV file</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>blotter_df.to_csv(<span class="st">"blotter.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              timestamp trade  fill_price  inventory  cash_position
0   2025-04-17 09:58:30  SELL      372.05         -2         372.05
1   2025-04-17 10:11:00  SELL      370.68         -3         742.73
2   2025-04-17 10:15:00  SELL      370.73         -4        1113.46
3   2025-04-17 10:19:30  SELL      370.72         -5        1484.18
4   2025-04-17 10:25:30  SELL      370.30         -6        1854.48
5   2025-04-17 10:28:00  SELL      370.06         -7        2224.54
6   2025-04-17 10:34:30  SELL      369.64         -8        2594.18
7   2025-04-17 10:39:30  SELL      368.87         -9        2963.05
8   2025-04-17 10:42:00  SELL      369.63        -10        3332.68
9   2025-04-17 10:42:30   BUY      369.55         -9        2963.13
10  2025-04-17 10:44:00  SELL      369.66        -10        3332.79
11  2025-04-17 10:45:00   BUY      369.86         -9        2962.93
12  2025-04-17 10:45:30  SELL      369.84        -10        3332.77
13  2025-04-17 10:47:00   BUY      370.03         -9        2962.74
14  2025-04-17 10:47:30   BUY      370.08         -8        2592.66
15  2025-04-17 10:48:30   BUY      370.14         -7        2222.52
16  2025-04-17 10:49:00  SELL      370.11         -8        2592.63
17  2025-04-17 10:51:30   BUY      370.16         -7        2222.47
18  2025-04-17 10:52:00   BUY      370.15         -6        1852.32
19  2025-04-17 10:54:30   BUY      370.10         -5        1482.22
20  2025-04-17 10:58:30  SELL      369.92         -6        1852.14
21  2025-04-17 10:59:30   BUY      369.81         -5        1482.33
22  2025-04-17 11:02:30   BUY      369.61         -4        1112.72
23  2025-04-17 11:04:30   BUY      369.49         -3         743.23
24  2025-04-17 11:10:00  SELL      371.30         -4        1114.53
25  2025-04-17 11:11:00  SELL      371.71         -5        1486.24
26  2025-04-17 11:13:30  SELL      371.64         -6        1857.88
27  2025-04-17 11:16:00  SELL      371.55         -7        2229.43
28  2025-04-17 11:19:30  SELL      372.11         -8        2601.54
29  2025-04-17 11:21:00  SELL      371.67         -9        2973.21
30  2025-04-17 11:25:30  SELL      371.25        -10        3344.46
31  2025-04-17 11:28:30  SELL      370.60        -11        3715.06
32  2025-04-17 11:29:30   BUY      370.45        -10        3344.61
33  2025-04-17 11:32:00  SELL      371.16        -11        3715.77
34  2025-04-17 11:34:30  SELL      371.36        -12        4087.13
35  2025-04-17 11:35:30  SELL      370.86        -13        4457.99
36  2025-04-17 11:39:30  SELL      371.46        -14        4829.45
37  2025-04-17 11:40:30   BUY      371.57        -13        4457.88
38  2025-04-17 11:41:30   BUY      371.30        -12        4086.58
39  2025-04-17 11:43:00   BUY      370.97        -11        3715.61
40  2025-04-17 11:44:30   BUY      370.77        -10        3344.84
41  2025-04-17 11:46:00  SELL      370.57        -11        3715.41
42  2025-04-17 11:47:00   BUY      370.84        -10        3344.57
43  2025-04-17 11:50:00  SELL      370.50        -11        3715.07
44  2025-04-17 11:53:30  SELL      370.68        -12        4085.75
45  2025-04-17 11:56:30  SELL      371.08        -13        4456.83
46  2025-04-17 11:57:00   BUY      371.13        -12        4085.70
47  2025-04-17 11:58:00  SELL      370.90        -13        4456.60
48  2025-04-17 11:58:30   BUY      370.90        -12        4085.70
49  2025-04-17 11:59:00   BUY      370.84        -11        3714.86
50  2025-04-17 11:59:30   BUY      370.84        -10        3344.02
51  2025-04-17 12:00:30   BUY      371.11         -9        2972.91
52  2025-04-17 12:01:30   BUY      371.00         -8        2601.91
53  2025-04-17 12:02:30   BUY      370.99         -7        2230.92
54  2025-04-17 12:04:30  SELL      370.70         -8        2601.62
55  2025-04-17 12:09:30  SELL      372.19         -9        2973.81
56  2025-04-17 12:10:30   BUY      371.81         -8        2602.00
57  2025-04-17 12:16:00  SELL      372.02         -9        2974.02
58  2025-04-17 12:18:00  SELL      371.71        -10        3345.73
59  2025-04-17 12:19:30  SELL      372.23        -11        3717.96
60  2025-04-17 12:22:00  SELL      372.07        -12        4090.03
61  2025-04-17 12:23:00  SELL      371.71        -13        4461.74
62  2025-04-17 12:23:30   BUY      371.80        -12        4089.94
63  2025-04-17 12:24:30  SELL      371.70        -13        4461.64
64  2025-04-17 12:27:00  SELL      371.84        -14        4833.48
65  2025-04-17 12:27:30  SELL      371.86        -15        5205.34
66  2025-04-17 12:28:00  SELL      371.86        -16        5577.20
67  2025-04-17 12:32:00  SELL      371.61        -17        5948.81
68  2025-04-17 12:33:30   BUY      372.05        -16        5576.76
69  2025-04-17 12:34:30   BUY      371.93        -15        5204.83
70  2025-04-17 12:36:00   BUY      371.96        -14        4832.87
71  2025-04-17 12:37:30   BUY      371.41        -13        4461.46
72  2025-04-17 12:40:30  SELL      371.06        -14        4832.52
73  2025-04-17 12:42:30  SELL      370.66        -15        5203.18
74  2025-04-17 12:46:30  SELL      370.25        -16        5573.43
75  2025-04-17 12:47:00   BUY      370.33        -15        5203.10
76  2025-04-17 12:47:30  SELL      370.31        -16        5573.41
77  2025-04-17 12:48:00   BUY      370.27        -15        5203.14
78  2025-04-17 12:50:30   BUY      370.44        -14        4832.70
79  2025-04-17 12:51:30   BUY      370.48        -13        4462.22
80  2025-04-17 12:53:30   BUY      371.29        -12        4090.93
81  2025-04-17 12:54:00   BUY      371.36        -11        3719.57
82  2025-04-17 12:54:30   BUY      371.37        -10        3348.20
83  2025-04-17 12:55:30   BUY      371.45         -9        2976.75
84  2025-04-17 12:57:30   BUY      371.42         -8        2605.33
85  2025-04-17 12:58:00   BUY      371.46         -7        2233.87
86  2025-04-17 12:59:30   BUY      371.52         -6        1862.35
87  2025-04-17 13:02:00   BUY      371.71         -5        1490.64
88  2025-04-17 13:02:30   BUY      371.67         -4        1118.97
89  2025-04-17 13:03:30   BUY      371.39         -3         747.58
90  2025-04-17 13:04:00  SELL      371.32         -4        1118.90
91  2025-04-17 13:05:00   BUY      371.53         -3         747.37
92  2025-04-17 13:06:30   BUY      371.20         -2         376.17
93  2025-04-17 13:07:30   BUY      371.33         -1           4.84
94  2025-04-17 13:08:00   BUY      371.37          0        -366.53
95  2025-04-17 13:11:30   BUY      371.19          1        -737.72
96  2025-04-17 13:13:30   BUY      371.14          2       -1108.86
97  2025-04-17 13:14:30   BUY      370.84          3       -1479.70
98  2025-04-17 13:15:30   BUY      370.99          4       -1850.69
99  2025-04-17 13:16:30   BUY      370.73          5       -2221.42
100 2025-04-17 13:17:00   BUY      370.77          6       -2592.19
101 2025-04-17 13:17:30   BUY      370.64          7       -2962.83
102 2025-04-17 13:18:30   BUY      370.65          8       -3333.48
103 2025-04-17 13:19:30   BUY      370.74          9       -3704.22
104 2025-04-17 13:20:30  SELL      370.63         -1           2.06
105 2025-04-17 13:22:00   BUY      370.50          0        -368.44
106 2025-04-17 13:23:30   BUY      370.54          1        -738.98
107 2025-04-17 13:24:00   BUY      370.52          2       -1109.50
108 2025-04-17 13:25:30   BUY      370.92          3       -1480.42
109 2025-04-17 13:27:00   BUY      370.48          4       -1850.90
110 2025-04-17 13:28:00   BUY      370.63          5       -2221.53
111 2025-04-17 13:29:30   BUY      370.41          6       -2591.94
112 2025-04-17 13:31:30   BUY      370.74          7       -2962.68
113 2025-04-17 13:33:00   BUY      370.79          8       -3333.47
114 2025-04-17 13:34:30   BUY      371.04          9       -3704.51
115 2025-04-17 13:37:30  SELL      370.98         -1           5.23
116 2025-04-17 13:38:30   BUY      371.13          0        -365.90
117 2025-04-17 13:39:30   BUY      371.20          1        -737.10
118 2025-04-17 13:41:00   BUY      371.04          2       -1108.14
119 2025-04-17 13:41:30   BUY      370.91          3       -1479.05
120 2025-04-17 13:47:30   BUY      371.81          4       -1850.86
121 2025-04-17 13:49:00   BUY      371.56          5       -2222.42
122 2025-04-17 13:54:00   BUY      371.62          6       -2594.04
123 2025-04-17 13:56:00   BUY      371.67          7       -2965.71
124 2025-04-17 13:57:00   BUY      371.36          8       -3337.07
125 2025-04-17 13:57:30   BUY      371.35          9       -3708.42
126 2025-04-17 13:58:30  SELL      371.22         -1           3.77
127 2025-04-17 13:59:30   BUY      371.12          0        -367.35
128 2025-04-17 14:01:30   BUY      371.12          1        -738.47
129 2025-04-17 14:07:30   BUY      371.50          2       -1109.97
130 2025-04-17 14:09:30   BUY      371.55          3       -1481.52
131 2025-04-17 14:12:00   BUY      371.41          4       -1852.93
132 2025-04-17 14:16:30   BUY      370.56          5       -2223.49
133 2025-04-17 14:19:30   BUY      371.36          6       -2594.85
134 2025-04-17 14:21:30   BUY      371.48          7       -2966.33
135 2025-04-17 14:22:30   BUY      371.56          8       -3337.89
136 2025-04-17 14:23:00   BUY      371.58          9       -3709.47
137 2025-04-17 14:26:30  SELL      370.86         -1          -0.91
138 2025-04-17 14:27:30   BUY      370.92          0        -371.83
139 2025-04-17 14:28:30   BUY      370.98          1        -742.81
140 2025-04-17 14:32:30   BUY      370.99          2       -1113.80
141 2025-04-17 14:33:30   BUY      370.86          3       -1484.66
142 2025-04-17 14:37:30   BUY      370.51          4       -1855.17
143 2025-04-17 14:38:00   BUY      370.54          5       -2225.71
144 2025-04-17 14:38:30   BUY      370.60          6       -2596.31
145 2025-04-17 14:39:00   BUY      370.57          7       -2966.88
146 2025-04-17 14:40:00   BUY      370.68          8       -3337.56
147 2025-04-17 14:43:00   BUY      370.52          9       -3708.08
148 2025-04-17 14:43:30  SELL      370.48         -1          -3.33
149 2025-04-17 14:46:00  SELL      370.90         -2         367.57
150 2025-04-17 14:49:30   BUY      370.19         -1          -2.62
151 2025-04-17 14:51:00  SELL      369.74         -2         367.12
152 2025-04-17 14:53:00   BUY      370.30         -1          -3.18
153 2025-04-17 14:55:30   BUY      369.98          0        -373.16
154 2025-04-17 15:01:00   BUY      369.38          1        -742.54
155 2025-04-17 15:04:30   BUY      369.30          2       -1111.84
156 2025-04-17 15:08:30   BUY      369.09          3       -1480.93
157 2025-04-17 15:09:30   BUY      369.19          4       -1850.12
158 2025-04-17 15:11:30   BUY      369.02          5       -2219.14
159 2025-04-17 15:25:30   BUY      368.14          6       -2587.28
160 2025-04-17 15:26:30   BUY      368.47          7       -2955.75
161 2025-04-17 15:29:00   BUY      368.60          8       -3324.35
162 2025-04-17 15:34:00   BUY      368.45          9       -3692.80
163 2025-04-17 15:40:30  SELL      368.43         -1          -8.49</code></pre>
</div>
</div>
<div id="d66a4f0da53a695b" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2025-04-20T19:18:01.430790Z&quot;,&quot;start_time&quot;:&quot;2025-04-20T19:18:01.029366Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6d7cfc9d0af23c6" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>